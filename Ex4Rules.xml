<ПравилаОбмена>
	<ВерсияФормата РежимСовместимости="РежимСовместимостиСБСП20">2.01</ВерсияФормата>
	<Ид>3611e798-5e5e-456e-9f7a-a455ef65e9f9    </Ид>
	<Наименование>UOT --&gt; UT10</Наименование>
	<ДатаВремяСоздания>2026-01-20T18:19:05</ДатаВремяСоздания>
	<Источник ВерсияПлатформы="8.0" ВерсияКонфигурации="11.5.25.85" СинонимКонфигурации="Управление торговлей, редакция 11">УправлениеТорговлей</Источник>
	<Приемник ВерсияПлатформы="8.0" ВерсияКонфигурации="1.5.7.3" СинонимКонфигурации="Федеральная компания, SK0014">ФедеральнаяКомпания</Приемник>
	<ПослеПолученияИнформацииОбУзлахОбмена>//ПКО_ЗаказКлиента = Правила["ЗаказКлиента"];
//тзПоискаТовары = ПКО_ЗаказКлиента.ПоискПоТабличнымЧастям;

//МассивКлючевыхПолейПоиска = Новый Массив;
//МассивКлючевыхПолейПоиска.Добавить("КодСтроки");
//КлючевыеПоляПоиска = СтрСоединить(МассивКлючевыхПолейПоиска, ",");

//СтрокаТЗ = тзПоискаТовары.Добавить();
//СтрокаТЗ.ИмяЭлемента = "ТабличнаяЧасть.Товары";
//СтрокаТЗ.МассивКлючевыхПолейПоиска = МассивКлючевыхПолейПоиска;
//СтрокаТЗ.КлючевыеПоляПоиска = КлючевыеПоляПоиска;
//СтрокаТЗ.Валидное = истина;</ПослеПолученияИнформацииОбУзлахОбмена>
	<ПослеЗагрузкиДанных>Для каждого СтрокаТЗ из Параметры.ДокументыДляОтложенногоПроведенияДоп Цикл
	СтрокаТаблицы = ДокументыДляОтложенногоПроведения().Добавить();
	ЗаполнитьЗначенияСвойств(СтрокаТаблицы, СтрокаТЗ);
КонецЦикла;

Для каждого дс из Параметры.мРТУдляУдаления Цикл
	до = дс.ПолучитьОбъект();
	Попытка
		до.УстановитьПометкуУдаления(Истина);
	Исключение
		текстОшибки = ОписаниеОшибки();
		Сообщить(дс);
		Сообщить(текстОшибки);
		ЗаписьЖурналаРегистрацииОбменДанными(текстОшибки, УровеньЖурналаРегистрации.Ошибка);
	КонецПопытки;
КонецЦикла; 

Выполнить(Алгоритмы.ВыполнитьОтложенноеПроведениеДокументов);</ПослеЗагрузкиДанных>
	<ПослеЗагрузкиПараметров>Параметры.Вставить("Организация", УзелОбменаЗагрузкаДанных.Организация);
Параметры.Вставить("Контрагент", УзелОбменаЗагрузкаДанных.Контрагент);
Параметры.Вставить("ДоговорКонтрагента", УзелОбменаЗагрузкаДанных.ДоговорКонтрагента);
Параметры.Вставить("ДоговорКонтрагентаВозврат", УзелОбменаЗагрузкаДанных.ДоговорКонтрагентаВозврат);
Параметры.Вставить("ТипЦен", УзелОбменаЗагрузкаДанных.ТипЦен);
Параметры.Вставить("УслугаУпаковки", УзелОбменаЗагрузкаДанных.УслугаУпаковки);
Параметры.Вставить("ВалютаРегламентированногоУчета", Константы.ВалютаРегламентированногоУчета.Получить());
Параметры.Вставить("УзелОбменаЗагрузкаДанных", УзелОбменаЗагрузкаДанных);
Параметры.Вставить("мЗаказовКОбратнойРегистрации", Новый Массив);
Параметры.Вставить("мРТУдляУдаления", Новый Массив);

Запрос = Новый Запрос(
"выбрать т.ссылка из справочник.КаналыСбыта как т
|где т.наименование = ""КЦ""");
Выборка = Запрос.Выполнить().Выбрать();
Если Выборка.Следующий() тогда
Параметры.Вставить("КаналСбыта", выборка.Ссылка);
Иначе
Параметры.Вставить("КаналСбыта", Неопределено);
КонецЕсли;

ДокументыДляОтложенногоПроведенияДоп = Новый ТаблицаЗначений;
ДокументыДляОтложенногоПроведенияДоп.Колонки.Добавить("ДокументОбъект"); // Поле оставлено для совместимости с предыдущими версиями
ДокументыДляОтложенногоПроведенияДоп.Колонки.Добавить("ДокументСсылка");
ДокументыДляОтложенногоПроведенияДоп.Колонки.Добавить("ДатаДокумента",           одОписаниеТипа("Дата"));
ДокументыДляОтложенногоПроведенияДоп.Колонки.Добавить("ДокументПроведенУспешно", одОписаниеТипа("Булево"));
ДокументыДляОтложенногоПроведенияДоп.Колонки.Добавить("ЭтоКоллизия", одОписаниеТипа("Число"));
Параметры.Вставить("ДокументыДляОтложенногоПроведенияДоп", ДокументыДляОтложенногоПроведенияДоп);</ПослеЗагрузкиПараметров>
	<Параметры/>
	<Обработки/>
	<ПравилаКонвертацииОбъектов>
		<Группа>
			<Код>Документы</Код>
			<Наименование>Документы</Наименование>
			<Порядок>50</Порядок>
			<Правило>
				<Код>ЗаказПокупателя</Код>
				<Наименование>Документ: Заказ клиента</Наименование>
				<Порядок>50</Порядок>
				<ПередВыгрузкой> 
СервисWildberries = Перечисления.CG_Online_Сервисы.Wildberries; 
 
Запрос = Запросы.ПолучитьКонтрагента;
Запрос.УстановитьПараметр("Сервис", СервисWildberries);
	
РезультатЗапроса = Запрос.Выполнить();

Контрагент = Неопределено;
ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
	Контрагент = ВыборкаДетальныеЗаписи.Контрагент;
	Прервать;
КонецЦикла;
	
ЭтоWildberries = ЗначениеЗаполнено(Контрагент) И Источник.Контрагент = Контрагент;   

Если ЭтоWildberries Тогда
	СчЗаполненных = 0;
	Для каждого Строка Из Источник.Товары Цикл
		Если ЗначениеЗаполнено(Строка.кд_НомерСборочногоЗаданияWB) Тогда
			СчЗаполненных = СчЗаполненных + 1;
		КонецЕсли;
	КонецЦикла;
	
	Если СчЗаполненных &lt; Источник.Товары.Количество() Тогда
		//Отказ = Истина;
	КонецЕсли;
КонецЕсли;

СтруктураДанных = Новый Структура;
СтруктураДанных.Вставить("ЭтоWildberries", ЭтоWildberries);  
ВходящиеДанные = СтруктураДанных;
//+
Запросы.ТоварыЗаказаКлиентаДоп.УстановитьПараметр("ЗаказКлиента", Источник.Ссылка);
РезультатЗапроса = Запросы.ТоварыЗаказаКлиентаДоп.Выполнить();
//ВходящиеДанные = Новый Структура;
ВходящиеДанные.Вставить("ТоварыЗаказаКлиентаДоп", РезультатЗапроса.Выгрузить());
//-</ПередВыгрузкой>
				<ПриЗагрузке>Объект.Товары.Очистить();
Объект.Услуги.Очистить();</ПриЗагрузке>
				<ПослеЗагрузки>
Переменная = Константы.ГраницаЗапретаИзмененияДокументов.Получить(); 

//changed+ Долгих Н. 27.05.2025 
ОбъектУТ10 = Неопределено;

Если ЗначениеЗаполнено(Объект.Ссылка) Тогда
	
	ОбъектУТ10 = Объект.Ссылка.ПолучитьОбъект();
	
	Если Не ОбъектУТ10 = Неопределено Тогда 
		
		Если ОбъектУТ10.Дата &lt; Переменная или ОбъектУТ10.кд_СтатусЗаказа = перечисления.кд_СтатусыЗаказов_МП.Отменен Тогда
			Отказ = Истина;
			
			//Если (Объект.Дата &lt; Переменная) или (ОбъектНайден = Ложь и Объект.кд_СтатусЗаказа = перечисления.кд_СтатусыЗаказов_МП.Отменен) Тогда
			//	Отказ = Истина;
			//иначе
		КонецЕсли;	
	//иначе 
	//	Выполнить(Алгоритмы.СозданиеЗаказа_п41);
	КонецЕсли;
КонецЕсли;
	//changed- Долгих Н. 27.05.2025   
	
	Выполнить(Алгоритмы.СозданиеЗаказа_п41);   
	
	текСтатусЗаказаОтменен = Истина;
	
	Если Объект.кд_СтатусЗаказа = перечисления.кд_СтатусыЗаказов_МП.Отменен Тогда
		Объект.СтатусЗаказа = перечисления.КД_СтатусыЗаказов.Отменен;
		текСтатусЗаказаОтменен = Истина;	
		
	ИначеЕсли Объект.кд_СтатусЗаказа = перечисления.кд_СтатусыЗаказов_МП.Принят Тогда
		Объект.СтатусЗаказа = перечисления.КД_СтатусыЗаказов.Принят;
	//ИначеЕсли Объект.кд_СтатусЗаказа = перечисления.кд_СтатусыЗаказов_МП.Отгрузка Тогда
	//	Объект.СтатусЗаказа = перечисления.КД_СтатусыЗаказов.ВРаботе;

	ИначеЕсли Объект.кд_СтатусЗаказа = перечисления.кд_СтатусыЗаказов_МП.ВДоставке 
		
		и значениезаполнено(Ссылка) Тогда
		Объект.СтатусЗаказа = перечисления.КД_СтатусыЗаказов.Выполнен;
		Параметры.мЗаказовКОбратнойРегистрации.Добавить(Ссылка); 
		
	//ИначеЕсли не ЗначениеЗаполнено(Объект.СтатусЗаказа) Тогда
	//	Объект.СтатусЗаказа = перечисления.КД_СтатусыЗаказов.Принят;
	//	Объект.кд_СтатусЗаказа = перечисления.кд_СтатусыЗаказов_МП.Принят; 
	КонецЕсли;
	Объект.ДополнительныеСвойства.Вставить("ЗаписьВРежимеОбменаДанными", Истина);
	
ЗаписьЖурналаРегистрацииОбменДанными("33333", УровеньЖурналаРегистрации.Предупреждение);
	Если Объект.СтатусЗаказа = перечисления.КД_СтатусыЗаказов.Отменен Тогда  
		Если ЗначениеЗаполнено(Объект.Ссылка) Тогда //+++Костерин О.В. 24.07.2025
			//+++Костерин О.В. 24.07.2025
			//ЗАПРОС ПЕРЕНЕС В Запросы 
			Запрос = Запросы.ЗакрытияЗаказов;
			//---Костерин О.В. 24.07.2025
			Запрос.УстановитьПараметр("Заказ", Объект.Ссылка);
			Выборка = Запрос.Выполнить().Выбрать();
			Если Выборка.Следующий() Тогда
				Если Выборка.кд_СтатусЗаказа = перечисления.кд_СтатусыЗаказов_МП.Отменен
					И ЗначениеЗаполнено(Выборка.Закрытие) Тогда
					//уже отменен
					текстОшибки = "Отмена заказа невозможна - уже отменен. " + СокрЛП(Ссылка);
					Сообщить(текстОшибки);
					ЗаписьЖурналаРегистрацииОбменДанными(текстОшибки, УровеньЖурналаРегистрации.Предупреждение);
					//changed+ Долгих Н. 27.05.2025 
					Отказ = Истина;
					//changed- Долгих Н. 27.05.2025
				ИначеЕсли ЗначениеЗаполнено(Выборка.РО) Тогда
					//Нельзя отменять - все уже ушло со склада
					//через возврат
					Объект.кд_СтатусЗаказа = перечисления.кд_СтатусыЗаказов_МП.ВДоставке;
					Объект.СтатусЗаказа = перечисления.КД_СтатусыЗаказов.Выполнен;
					Параметры.мЗаказовКОбратнойРегистрации.Добавить(Ссылка);
					текстОшибки = "Отмена заказа невозможна - есть расходный ордер. " + СокрЛП(Ссылка);
					Сообщить(текстОшибки);
					ЗаписьЖурналаРегистрацииОбменДанными(текстОшибки, УровеньЖурналаРегистрации.Предупреждение);
					//changed+ Долгих Н. 27.05.2025 
					Отказ = Истина; 
					//changed- Долгих Н. 27.05.2025 
				Иначе
					//+++Костерин О.В. 24.07.2025
					//ПРЕНЕС С Алгоритмы
					РТУ = Выборка.РТУ; 
					ОбъектСсылка = Объект.Ссылка;  
					Выполнить(Алгоритмы.СоздатьЗакрытиеЗаказовПокупателей);
					//---Костерин О.В. 24.07.2025
				КонецЕсли;
			КонецЕсли;
		//+++Костерин О.В. 24.07.2025	
		Иначе  
			
			Попытка
				Объект.Записать();
				ОбъектЗаписан = Истина;
			Исключение
				ОписаниеОшибки = КраткоеПредставлениеОшибки(ИнформацияОбОшибке());
				Сообщить("Документ ""Заказ клиента"" не записан: " + ОписаниеОшибки);
				ЗаписьЖурналаРегистрацииОбменДанными(ОписаниеОшибки, УровеньЖурналаРегистрации.Предупреждение);	 
				ОбъектЗаписан = Ложь;
			КонецПопытки;
			
			Если ОбъектЗаписан Тогда
				РТУ = Неопределено;   
				ОбъектСсылка = Объект.Ссылка;
				Выполнить(Алгоритмы.СоздатьЗакрытиеЗаказовПокупателей);  
			КонецЕсли;
		КонецЕсли; 
		//---Костерин О.В. 24.07.2025
	КонецЕсли;
	
	//changed+ Долгих Н. 28.05.2025  
	Если (Не ОбъектУТ10 = Неопределено) и (Ссылка.Проведен = Истина И Ссылка.Товары.Количество()&gt;0) Тогда
		//Если ОбъектНайден = Истина и (Ссылка.Проведен = Истина И Ссылка.Товары.Количество()&gt;0) Тогда
		//Отказ = Истина;
		текСтатусЗаказа = Объект.СтатусЗаказа;
		теккд_СтатусЗаказа = Объект.кд_СтатусЗаказа;
		//Объект = Ссылка.ПолучитьОбъект();
		
		//Если не Отказ = Истина и (не ОбъектУТ10.СтатусЗаказа = текСтатусЗаказа или не ОбъектУТ10.кд_СтатусЗаказа = теккд_СтатусЗаказа) Тогда
		Если не Отказ = Истина и Объект.кд_СтатусЗаказа = перечисления.кд_СтатусыЗаказов_МП.Отменен Тогда
		
			ОбъектУТ10.СтатусЗаказа = текСтатусЗаказа;
			ОбъектУТ10.кд_СтатусЗаказа = теккд_СтатусЗаказа;
			ОбъектУТ10.ОбменДанными.Загрузка = Истина;
			ОбъектУТ10.ДополнительныеСвойства.Вставить("ЗаписьВРежимеОбменаДанными", Истина);
			ОбъектУТ10.Записать();
			Отказ = Истина;
		КонецЕсли;
		
		//Если не Объект.СтатусЗаказа = текСтатусЗаказа или не Объект.кд_СтатусЗаказа = теккд_СтатусЗаказа Тогда
		//	Объект.СтатусЗаказа = текСтатусЗаказа;
		//	Объект.кд_СтатусЗаказа = теккд_СтатусЗаказа;
		//	Объект.ОбменДанными.Загрузка = Истина;
		//	Объект.ДополнительныеСвойства.Вставить("ЗаписьВРежимеОбменаДанными", Истина);
		//	Объект.Записать();
		//КонецЕсли;
	КонецЕСли; 

//changed+ Долгих Н. 28.05.2025  

Выполнить(Алгоритмы.ВременнаяОтменаПроведенияСвязаннойРеализации); //Костерин О.В. 29.07.2025

// Запись данных в регистр сведений КД_МПВБЗаказПокупателя
Если Не Отказ Тогда
	Для Каждого СтрокаТовары Из Объект.Товары Цикл
		// Ищем соответствующую строку в дополнительных данных
		СтрокиДоп = ВходящиеДанные.ТоварыЗаказаКлиентаДоп.НайтиСтроки(Новый Структура("КодСтроки", СтрокаТовары.КодСтроки));
		Если СтрокиДоп.Количество() > 0 Тогда
			СтрокаДоп = СтрокиДоп[0];
			
			// Создаем запись регистра сведений
			стрВходящиеДанные = Новый Структура;
			стрВходящиеДанные.Вставить("ЗаказПокупателя", Объект.Ссылка);
			стрВходящиеДанные.Вставить("Номенклатура", СтрокаТовары.Номенклатура);
			стрВходящиеДанные.Вставить("КодСтроки", СтрокаТовары.КодСтроки);
			стрВходящиеДанные.Вставить("СРИД", СтрокаДоп.СРИД);
			стрВходящиеДанные.Вставить("НомерСборочногоЗадания", СтрокаДоп.НомерСборочногоЗадания);
			стрВходящиеДанные.Вставить("СтикерЗначение", СтрокаДоп.СтикерЗначение);
			
			ВыгрузитьПоПравилу(стрВходящиеДанные,,стрВходящиеДанные,, "КД_МПВБЗаказПокупателя",,,,,,,,,,);
		КонецЕсли;
	КонецЦикла;
КонецЕсли;</ПослеЗагрузки>
				<СинхронизироватьПоИдентификатору>true</СинхронизироватьПоИдентификатору>
				<Источник>ДокументСсылка.ЗаказКлиента</Источник>
				<Приемник>ДокументСсылка.ЗаказПокупателя</Приемник>
				<Свойства>
					<Свойство Отключить="true">
						<Код>9</Код>
						<Наименование>--&gt; ЗаказПоставщику</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ЗаказПоставщику" Вид="Реквизит" Тип="Число"/>
					</Свойство>
					<Свойство Отключить="true">
						<Код>10</Код>
						<Наименование>ДатаОтгрузки --&gt; ДатаОтгрузки</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="ДатаОтгрузки" Вид="Реквизит" Тип="Дата"/>
						<Приемник Имя="ДатаОтгрузки" Вид="Реквизит" Тип="Дата"/>
					</Свойство>
					<Свойство Отключить="true">
						<Код>11</Код>
						<Наименование>кд_МаркетПлейс --&gt; кд_МаркетПлейс</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="кд_МаркетПлейс" Вид="Реквизит" Тип="ПеречислениеСсылка.кд_МаркетПлейсы"/>
						<Приемник Имя="кд_МаркетПлейс" Вид="Реквизит" Тип="ПеречислениеСсылка.кд_МаркетПлейсы"/>
						<КодПравилаКонвертации>кд_МаркетПлейсы                                   </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>24</Код>
						<Наименование>--&gt; Комментарий</Наименование>
						<Порядок>200</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/>
						<ПередВыгрузкой>
Если ВходящиеДанные.ЭтоWildberries Тогда 
	Значение = "";
Иначе
	Значение = "Номер по данным клиента: " + ?(ЗначениеЗаполнено(Источник.НомерПоДаннымКлиента), Источник.НомерПоДаннымКлиента, "");   
КонецЕсли;</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>12</Код>
						<Наименование>--&gt; КомментарийКЦ</Наименование>
						<Порядок>200</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="КомментарийКЦ" Вид="Реквизит" Тип="Строка"/>
						<ПередВыгрузкой>
Если ВходящиеДанные.ЭтоWildberries Тогда 
	ТекЗначение = "";
	Для каждого Строка Из Источник.Товары Цикл
		ТекЗначение = ТекЗначение + ?(ТекЗначение = "", "", Символы.ПС) + 
									"Номер сборочного задания WB: " + 
									?(ЗначениеЗаполнено(Строка.кд_НомерСборочногоЗаданияWB), Строка.кд_НомерСборочногоЗаданияWB, ""); 
	КонецЦикла;
								
	Значение = ТекЗначение;
Иначе
	Значение = "Номер по данным клиента: " + ?(ЗначениеЗаполнено(Источник.НомерПоДаннымКлиента), Источник.НомерПоДаннымКлиента, "");
КонецЕсли;

АвтоКомментарий = СокрЛП(ТекущаяДатаСеанса());
Значение = Значение + Символы.ПС + ?(ЗначениеЗаполнено(Источник.Комментарий), СокрЛП(Источник.Комментарий), АвтоКомментарий);</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>22</Код>
						<Наименование>--&gt; кд_интернетНомерСклада</Наименование>
						<Порядок>250</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>кд_интернетНомерСклада</ИмяПараметраДляПередачи>
						<ПередВыгрузкой>Попытка
	Значение = Число(Источник.Склад.кд_интернетНомерСклада);
Исключение
	Значение = 0;
КонецПопытки;</ПередВыгрузкой>
					</Свойство>
					<Свойство Отключить="true">
						<Код>16</Код>
						<Наименование>Дата --&gt; Дата</Наименование>
						<Порядок>300</Порядок>
						<Источник Имя="Дата" Вид="Свойство" Тип="Дата"/>
						<Приемник Имя="Дата" Вид="Свойство" Тип="Дата"/>
					</Свойство>
					<Свойство>
						<Код>19</Код>
						<Наименование>Проведен --&gt; Проведен</Наименование>
						<Порядок>350</Порядок>
						<Источник Имя="Проведен" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="Проведен" Вид="Свойство" Тип="Булево"/>
					</Свойство>
					<Свойство Отключить="true">
						<Код>25</Код>
						<Наименование>Проведен --&gt; Проведен</Наименование>
						<Порядок>350</Порядок>
						<Источник Имя="Проведен" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>Проведен</ИмяПараметраДляПередачи>
					</Свойство>
					<Свойство>
						<Код>20</Код>
						<Наименование>Валюта --&gt; ВалютаДокумента</Наименование>
						<Порядок>400</Порядок>
						<Источник Имя="Валюта" Вид="Реквизит" Тип="СправочникСсылка.Валюты"/>
						<Приемник Имя="ВалютаДокумента" Вид="Реквизит" Тип="СправочникСсылка.Валюты"/>
						<КодПравилаКонвертации>Валюты                                            </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>23</Код>
						<Наименование>кд_СтатусЗаказа --&gt; кд_СтатусЗаказа</Наименование>
						<Порядок>450</Порядок>
						<Источник Имя="кд_СтатусЗаказа" Вид="Реквизит" Тип="ПеречислениеСсылка.кд_СтатусыЗаказов"/>
						<Приемник Имя="кд_СтатусЗаказа" Вид="Реквизит" Тип="ПеречислениеСсылка.кд_СтатусыЗаказов_МП"/>
						<КодПравилаКонвертации>КД_СтатусыЗаказов                                 </КодПравилаКонвертации>
						<ПередВыгрузкой>//changed+ Долгих Н. 28.05.2025

//Если не Источник.кд_СтатусЗаказа = перечисления.кд_СтатусыЗаказов.Отменен тогда отказ = Истина КонецЕсли; 
//changed- Долгих Н. 28.05.2025</ПередВыгрузкой>
					</Свойство>
					<Группа>
						<Код>1</Код>
						<Наименование>Товары --&gt; Товары</Наименование>
						<Порядок>500</Порядок>
						<Источник Имя="Товары" Вид="ТабличнаяЧасть"/>
						<Приемник Имя="Товары" Вид="ТабличнаяЧасть"/>
						<ПередОбработкойВыгрузки>КоллекцияОбъектов = ВходящиеДанные.ТоварыЗаказаКлиентаДоп;</ПередОбработкойВыгрузки>
						<Свойство Поиск="true">
							<Код>2</Код>
							<Наименование>КодСтроки --&gt; КодСтроки</Наименование>
							<Порядок>50</Порядок>
							<Источник Имя="КодСтроки" Вид="Реквизит" Тип="Число"/>
							<Приемник Имя="КодСтроки" Вид="Реквизит" Тип="Число"/>
						</Свойство>
						<Свойство>
							<Код>3</Код>
							<Наименование>Количество --&gt; Количество</Наименование>
							<Порядок>100</Порядок>
							<Источник Имя="Количество" Вид="Реквизит" Тип="Число"/>
							<Приемник Имя="Количество" Вид="Реквизит" Тип="Число"/>
						</Свойство>
						<Свойство>
							<Код>4</Код>
							<Наименование>Номенклатура --&gt; Номенклатура</Наименование>
							<Порядок>150</Порядок>
							<Источник Имя="Номенклатура" Вид="Реквизит" Тип="СправочникСсылка.Номенклатура"/>
							<Приемник Имя="Номенклатура" Вид="Реквизит" Тип="СправочникСсылка.Номенклатура"/>
							<КодПравилаКонвертации>Номенклатура                                      </КодПравилаКонвертации>
						</Свойство>
						<Свойство>
							<Код>21</Код>
							<Наименование>Номенклатура --&gt; ХарактеристикаНоменклатуры</Наименование>
							<Порядок>200</Порядок>
							<Источник Имя="Номенклатура" Вид="Реквизит" Тип="СправочникСсылка.Номенклатура"/>
							<Приемник Имя="ХарактеристикаНоменклатуры" Вид="Реквизит" Тип="СправочникСсылка.ХарактеристикиНоменклатуры"/>
							<КодПравилаКонвертации>ХарактеристикиНоменклатуры                        </КодПравилаКонвертации>
						</Свойство>
						<Свойство>
							<Код>46</Код>
							<Наименование>--&gt; НомерСборочногоЗадания</Наименование>
							<Порядок>2000</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="НомерСборочногоЗадания" Вид="Реквизит" Тип="Строка"/>
							<ПриВыгрузке>значение=ОбъектКоллекции.НомерСборочногоЗадания;</ПриВыгрузке>
						</Свойство>
						<Свойство>
							<Код>45</Код>
							<Наименование>--&gt; СРИД</Наименование>
							<Порядок>2000</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СРИД" Вид="Реквизит" Тип="Строка"/>
							<ПриВыгрузке>значение=ОбъектКоллекции.срид;</ПриВыгрузке>
						</Свойство>
						<Свойство>
							<Код>47</Код>
							<Наименование>Цена --&gt; Цена</Наименование>
							<Порядок>2050</Порядок>
							<Источник Имя="Цена" Вид="Реквизит" Тип="Число"/>
							<Приемник Имя="Цена" Вид="Реквизит" Тип="Число"/>
						</Свойство>
					</Группа>
					<Свойство>
						<Код>26</Код>
						<Наименование>--&gt; ЭтоWildberries</Наименование>
						<Порядок>550</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>ЭтоWildberries</ИмяПараметраДляПередачи>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>КорректировкаЗаказаПокупателя</Код>
				<Наименование>Документ: Корректировка заказа покупателя</Наименование>
				<Порядок>75</Порядок>
				<ПередВыгрузкой> 
СервисWildberries = Перечисления.CG_Online_Сервисы.Wildberries; 
 
Запрос = Запросы.ПолучитьКонтрагента;
Запрос.УстановитьПараметр("Сервис", СервисWildberries);
	
РезультатЗапроса = Запрос.Выполнить();

Контрагент = Неопределено;
ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
	Контрагент = ВыборкаДетальныеЗаписи.Контрагент;
	Прервать;
КонецЦикла;
	
ЭтоWildberries = ЗначениеЗаполнено(Контрагент) И Источник.Контрагент = Контрагент;   

Если ЭтоWildberries Тогда
	СчЗаполненных = 0;
	Для каждого Строка Из Источник.Товары Цикл
		//Если ЗначениеЗаполнено(Строка.кд_НомерСборочногоЗаданияWB) Тогда
			СчЗаполненных = СчЗаполненных + 1;
		//КонецЕсли;
	КонецЦикла;
	
	Если СчЗаполненных &lt; Источник.Товары.Количество() Тогда
		//Отказ = Истина;
	КонецЕсли;
КонецЕсли;

СтруктураДанных = Новый Структура;
СтруктураДанных.Вставить("ЭтоWildberries", ЭтоWildberries);  
ВходящиеДанные = СтруктураДанных;
//+
Запросы.ТоварыЗаказаКлиентаДоп.УстановитьПараметр("ЗаказКлиента", Источник.Ссылка);
РезультатЗапроса = Запросы.ТоварыЗаказаКлиентаДоп.Выполнить();
//ВходящиеДанные = Новый Структура;
ВходящиеДанные.Вставить("ТоварыЗаказаКлиентаДоп", РезультатЗапроса.Выгрузить());
//-</ПередВыгрузкой>
				<ПриЗагрузке>Объект.Товары.Очистить();
Объект.Услуги.Очистить();</ПриЗагрузке>
				<ПослеЗагрузки>//СозданиеЗаказа41
Если не ЗначениеЗаполнено(Объект.Дата) Тогда
	Объект.Дата = ТекущаяДатаСеанса();
КонецЕсли;



//Объект.Организация = параметры.Организация;
Объект.Контрагент = параметры.Контрагент;
//Объект.ДоговорКонтрагента = параметры.ДоговорКонтрагента;
текТипЦен = Параметры.ТипЦен;

//Объект.ФормаОплаты = перечисления.ФормаОплаты.Безналичный;
Объект.СуммаВключаетНДС = Истина;
Объект.УчитыватьНДС = Истина;
Объект.КратностьВзаиморасчетов = 1;
Объект.КурсВзаиморасчетов = 1;
Объект.ТипЦен = текТипЦен;

Для каждого строкаТЧ из Объект.Товары Цикл
	текХарактеристика = СтрокаТЧ.ХарактеристикаНоменклатуры;
	ОбработкаТабличныхЧастей.ПриИзмененииНоменклатурыТабЧасти(строкаТЧ, Объект);
		ОбработкаТабличныхЧастей.ЗаполнитьЕдиницуТабЧасти(строкаТЧ, Объект); 
		ОбработкаТабличныхЧастей.ЗаполнитьСтавкуНДСТабЧасти(строкаТЧ, Объект); 
		ОбработкаТабличныхЧастей.РассчитатьСуммуТабЧасти(строкаТЧ, Объект);
		ОбработкаТабличныхЧастей.РассчитатьСуммуНДСТабЧасти(строкаТЧ, Объект);
	Если СтрокаТЧ.Номенклатура.ВестиУчетПоХарактеристикам Тогда
		СтрокаТЧ.ХарактеристикаНоменклатуры = текХарактеристика;
	КонецЕсли;
	СтрокаТЧ.Размещение = Объект.Склад;
КонецЦикла;

Объект.СтруктурнаяЕдиница=Справочники.БанковскиеСчета.НайтиПоРеквизиту("НомерСчета","40702810323000086672");


Объект.СуммаДокумента = Объект.товары.Итог("Сумма") + Объект.Услуги.Итог("Сумма");

// Запись данных в регистр сведений КД_МПВБЗаказПокупателя
Если Не Отказ И ВходящиеДанные.Свойство("ТоварыЗаказаКлиентаДоп") Тогда
	Для Каждого СтрокаТовары Из Объект.Товары Цикл
		// Ищем соответствующую строку в дополнительных данных
		СтрокиДоп = ВходящиеДанные.ТоварыЗаказаКлиентаДоп.НайтиСтроки(Новый Структура("КодСтроки", СтрокаТовары.КодСтроки));
		Если СтрокиДоп.Количество() > 0 Тогда
			СтрокаДоп = СтрокиДоп[0];
			
			// Создаем запись регистра сведений
			стрВходящиеДанные = Новый Структура;
			стрВходящиеДанные.Вставить("ЗаказПокупателя", Объект.ЗаказПокупателя);
			стрВходящиеДанные.Вставить("Номенклатура", СтрокаТовары.Номенклатура);
			стрВходящиеДанные.Вставить("КодСтроки", СтрокаТовары.КодСтроки);
			стрВходящиеДанные.Вставить("СРИД", СтрокаДоп.СРИД);
			стрВходящиеДанные.Вставить("НомерСборочногоЗадания", СтрокаДоп.НомерСборочногоЗадания);
			стрВходящиеДанные.Вставить("СтикерЗначение", СтрокаДоп.СтикерЗначение);
			
			ВыгрузитьПоПравилу(стрВходящиеДанные,,стрВходящиеДанные,, "КД_МПВБЗаказПокупателя",,,,,,,,,,);
		КонецЕсли;
	КонецЦикла;
КонецЕсли;</ПослеЗагрузки>
				<СинхронизироватьПоИдентификатору>true</СинхронизироватьПоИдентификатору>
				<Источник>ДокументСсылка.ЗаказКлиента</Источник>
				<Приемник>ДокументСсылка.КорректировкаЗаказаПокупателя</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>9</Код>
						<Наименование>--&gt; ЗаказПокупателя</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ЗаказПокупателя" Вид="Реквизит" Тип="ДокументСсылка.ЗаказПокупателя"/>
						<КодПравилаКонвертации>ЗаказПокупателя                                   </КодПравилаКонвертации>
						<ПередВыгрузкой>	Значение = Источник.Ссылка;</ПередВыгрузкой>
					</Свойство>
					<Свойство Отключить="true">
						<Код>10</Код>
						<Наименование>ДатаОтгрузки --&gt; ДатаОтгрузки</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="ДатаОтгрузки" Вид="Реквизит" Тип="Дата"/>
						<Приемник Имя="ДатаОтгрузки" Вид="Реквизит" Тип="Дата"/>
					</Свойство>
					<Свойство Отключить="true">
						<Код>11</Код>
						<Наименование>кд_МаркетПлейс --&gt; кд_МаркетПлейс</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="кд_МаркетПлейс" Вид="Реквизит" Тип="ПеречислениеСсылка.кд_МаркетПлейсы"/>
						<Приемник Имя="кд_МаркетПлейс" Вид="Реквизит" Тип="ПеречислениеСсылка.кд_МаркетПлейсы"/>
						<КодПравилаКонвертации>кд_МаркетПлейсы                                   </КодПравилаКонвертации>
					</Свойство>
					<Свойство Отключить="true">
						<Код>24</Код>
						<Наименование>--&gt; Комментарий</Наименование>
						<Порядок>200</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство Отключить="true">
						<Код>12</Код>
						<Наименование>--&gt; КомментарийКЦ</Наименование>
						<Порядок>200</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="КомментарийКЦ" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство Отключить="true">
						<Код>22</Код>
						<Наименование>--&gt; кд_интернетНомерСклада</Наименование>
						<Порядок>250</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>кд_интернетНомерСклада</ИмяПараметраДляПередачи>
					</Свойство>
					<Свойство>
						<Код>19</Код>
						<Наименование>Проведен --&gt; Проведен</Наименование>
						<Порядок>350</Порядок>
						<Источник Имя="Проведен" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="Проведен" Вид="Свойство" Тип="Булево"/>
					</Свойство>
					<Свойство Отключить="true">
						<Код>20</Код>
						<Наименование>Валюта --&gt; ВалютаДокумента</Наименование>
						<Порядок>400</Порядок>
						<Источник Имя="Валюта" Вид="Реквизит" Тип="СправочникСсылка.Валюты"/>
						<Приемник Имя="" Вид=""/>
						<КодПравилаКонвертации>Валюты                                            </КодПравилаКонвертации>
						<ИмяПараметраДляПередачи>ВалютаДокумента</ИмяПараметраДляПередачи>
					</Свойство>
					<Свойство Отключить="true">
						<Код>23</Код>
						<Наименование>кд_СтатусЗаказа --&gt; кд_СтатусЗаказа</Наименование>
						<Порядок>450</Порядок>
						<Источник Имя="кд_СтатусЗаказа" Вид="Реквизит" Тип="ПеречислениеСсылка.кд_СтатусыЗаказов"/>
						<Приемник Имя="кд_СтатусЗаказа" Вид="Реквизит" Тип="ПеречислениеСсылка.кд_СтатусыЗаказов_МП"/>
						<КодПравилаКонвертации>КД_СтатусыЗаказов                                 </КодПравилаКонвертации>
					</Свойство>
					<Группа>
						<Код>1</Код>
						<Наименование>Товары --&gt; Товары</Наименование>
						<Порядок>500</Порядок>
						<Источник Имя="Товары" Вид="ТабличнаяЧасть"/>
						<Приемник Имя="Товары" Вид="ТабличнаяЧасть"/>
						<Свойство Поиск="true">
							<Код>2</Код>
							<Наименование>КодСтроки --&gt; КодСтроки</Наименование>
							<Порядок>50</Порядок>
							<Источник Имя="КодСтроки" Вид="Реквизит" Тип="Число"/>
							<Приемник Имя="КодСтроки" Вид="Реквизит" Тип="Число"/>
						</Свойство>
						<Свойство>
							<Код>3</Код>
							<Наименование>Количество --&gt; Количество</Наименование>
							<Порядок>100</Порядок>
							<Источник Имя="Количество" Вид="Реквизит" Тип="Число"/>
							<Приемник Имя="Количество" Вид="Реквизит" Тип="Число"/>
						</Свойство>
						<Свойство>
							<Код>4</Код>
							<Наименование>Номенклатура --&gt; Номенклатура</Наименование>
							<Порядок>150</Порядок>
							<Источник Имя="Номенклатура" Вид="Реквизит" Тип="СправочникСсылка.Номенклатура"/>
							<Приемник Имя="Номенклатура" Вид="Реквизит" Тип="СправочникСсылка.Номенклатура"/>
							<КодПравилаКонвертации>Номенклатура                                      </КодПравилаКонвертации>
						</Свойство>
						<Свойство>
							<Код>21</Код>
							<Наименование>Номенклатура --&gt; ХарактеристикаНоменклатуры</Наименование>
							<Порядок>200</Порядок>
							<Источник Имя="Номенклатура" Вид="Реквизит" Тип="СправочникСсылка.Номенклатура"/>
							<Приемник Имя="ХарактеристикаНоменклатуры" Вид="Реквизит" Тип="СправочникСсылка.ХарактеристикиНоменклатуры"/>
							<КодПравилаКонвертации>ХарактеристикиНоменклатуры                        </КодПравилаКонвертации>
						</Свойство>
						<Свойство>
							<Код>47</Код>
							<Наименование>Цена --&gt; Цена</Наименование>
							<Порядок>2050</Порядок>
							<Источник Имя="Цена" Вид="Реквизит" Тип="Число"/>
							<Приемник Имя="Цена" Вид="Реквизит" Тип="Число"/>
						</Свойство>
					</Группа>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>РеализацияТоваровУслуг</Код>
				<Наименование>Документ: Реализация товаров и услуг</Наименование>
				<Порядок>100</Порядок>
				<ПередВыгрузкой>//changed+ Долгих Н. 24.06.2025
дт = Источник.Дата;
дтНД = НачалоДня(ТекущаяДата());
Если НачалоДня(дт) &lt; дтНД тогда
	Если (дтНД - дт) &gt; 1200 или Источник.кд_НомерСФ = "" тогда	
		отказ = Истина;	
	конецесли;
конецесли; 
//changed- Долгих Н. 24.06.2025</ПередВыгрузкой>
				<ПослеЗагрузки>
Переменная = Константы.ГраницаЗапретаИзмененияДокументов.Получить();

Если Объект.Дата &lt; Переменная или ОбъектНайден = Истина Тогда
	Отказ = Истина;
иначе
	Выполнить(Алгоритмы.СозданиеПТиУ_п411);
	Объект.ДополнительныеСвойства.Вставить("ЗаписьВРежимеОбменаДанными", Истина);
конецесли;</ПослеЗагрузки>
				<СинхронизироватьПоИдентификатору>true</СинхронизироватьПоИдентификатору>
				<Источник>ДокументСсылка.РеализацияТоваровУслуг</Источник>
				<Приемник>ДокументСсылка.ПоступлениеТоваровУслуг</Приемник>
				<Свойства>
					<Свойство>
						<Код>12</Код>
						<Наименование>Дата --&gt; Дата</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="Дата" Вид="Свойство" Тип="Дата"/>
						<Приемник Имя="Дата" Вид="Свойство" Тип="Дата"/>
					</Свойство>
					<Свойство Поиск="true">
						<Код>16</Код>
						<Наименование>кд_НомерСФ --&gt; НомерВходящегоДокумента</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="кд_НомерСФ" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="НомерВходящегоДокумента" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство Отключить="true">
						<Код>14</Код>
						<Наименование>Проведен --&gt; Проведен</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="Проведен" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="Проведен" Вид="Свойство" Тип="Булево"/>
					</Свойство>
					<Свойство>
						<Код>15</Код>
						<Наименование>Дата --&gt; ДатаВходящегоДокумента</Наименование>
						<Порядок>200</Порядок>
						<Источник Имя="Дата" Вид="Свойство" Тип="Дата"/>
						<Приемник Имя="ДатаВходящегоДокумента" Вид="Реквизит" Тип="Дата"/>
					</Свойство>
					<Свойство>
						<Код>17</Код>
						<Наименование>ЦенаВключаетНДС --&gt; СуммаВключаетНДС</Наименование>
						<Порядок>250</Порядок>
						<Источник Имя="ЦенаВключаетНДС" Вид="Реквизит" Тип="Булево"/>
						<Приемник Имя="СуммаВключаетНДС" Вид="Реквизит" Тип="Булево"/>
					</Свойство>
					<Свойство>
						<Код>18</Код>
						<Наименование>Валюта --&gt; ВалютаДокумента</Наименование>
						<Порядок>300</Порядок>
						<Источник Имя="Валюта" Вид="Реквизит" Тип="СправочникСсылка.Валюты"/>
						<Приемник Имя="ВалютаДокумента" Вид="Реквизит" Тип="СправочникСсылка.Валюты"/>
						<КодПравилаКонвертации>Валюты                                            </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>19</Код>
						<Наименование>--&gt; кд_интернетНомерСклада</Наименование>
						<Порядок>350</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>кд_интернетНомерСклада</ИмяПараметраДляПередачи>
						<ПередВыгрузкой>Попытка
	Значение = Число(Источник.Склад.кд_интернетНомерСклада);
Исключение
	Значение = 0;
КонецПопытки;</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>11</Код>
						<Наименование>Комментарий --&gt; Комментарий</Наименование>
						<Порядок>400</Порядок>
						<Источник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Группа>
						<Код>1</Код>
						<Наименование>Товары --&gt; Товары</Наименование>
						<Порядок>450</Порядок>
						<Источник Имя="Товары" Вид="ТабличнаяЧасть"/>
						<Приемник Имя="Товары" Вид="ТабличнаяЧасть"/>
						<Свойство>
							<Код>5</Код>
							<Наименование>Номенклатура --&gt; Номенклатура</Наименование>
							<Порядок>150</Порядок>
							<Источник Имя="Номенклатура" Вид="Реквизит" Тип="СправочникСсылка.Номенклатура"/>
							<Приемник Имя="Номенклатура" Вид="Реквизит" Тип="СправочникСсылка.Номенклатура"/>
							<КодПравилаКонвертации>Номенклатура                                      </КодПравилаКонвертации>
						</Свойство>
						<Свойство>
							<Код>10</Код>
							<Наименование>Номенклатура --&gt; ХарактеристикаНоменклатуры</Наименование>
							<Порядок>200</Порядок>
							<Источник Имя="Номенклатура" Вид="Реквизит" Тип="СправочникСсылка.Номенклатура"/>
							<Приемник Имя="ХарактеристикаНоменклатуры" Вид="Реквизит" Тип="СправочникСсылка.ХарактеристикиНоменклатуры"/>
							<КодПравилаКонвертации>ХарактеристикиНоменклатуры                        </КодПравилаКонвертации>
						</Свойство>
						<Свойство>
							<Код>4</Код>
							<Наименование>Количество --&gt; Количество</Наименование>
							<Порядок>250</Порядок>
							<Источник Имя="Количество" Вид="Реквизит" Тип="Число"/>
							<Приемник Имя="Количество" Вид="Реквизит" Тип="Число"/>
						</Свойство>
						<Свойство>
							<Код>6</Код>
							<Наименование>--&gt; СтавкаНДС</Наименование>
							<Порядок>300</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="СтавкаНДС" Вид="Реквизит" Тип="ПеречислениеСсылка.СтавкиНДС"/>
							<КодПравилаКонвертации>СтавкиНДС                                         </КодПравилаКонвертации>
							<ПередВыгрузкой>Значение = ОбъектКоллекции.СтавкаНДС.ПеречислениеСтавкаНДС;</ПередВыгрузкой>
						</Свойство>
						<Свойство>
							<Код>7</Код>
							<Наименование>Сумма --&gt; Сумма</Наименование>
							<Порядок>350</Порядок>
							<Источник Имя="Сумма" Вид="Реквизит" Тип="Число"/>
							<Приемник Имя="Сумма" Вид="Реквизит" Тип="Число"/>
						</Свойство>
						<Свойство>
							<Код>8</Код>
							<Наименование>СуммаНДС --&gt; СуммаНДС</Наименование>
							<Порядок>400</Порядок>
							<Источник Имя="СуммаНДС" Вид="Реквизит" Тип="Число"/>
							<Приемник Имя="СуммаНДС" Вид="Реквизит" Тип="Число"/>
						</Свойство>
						<Свойство>
							<Код>9</Код>
							<Наименование>Цена --&gt; Цена</Наименование>
							<Порядок>450</Порядок>
							<Источник Имя="Цена" Вид="Реквизит" Тип="Число"/>
							<Приемник Имя="Цена" Вид="Реквизит" Тип="Число"/>
						</Свойство>
					</Группа>
					<Группа>
						<Код>20</Код>
						<Наименование>ШтрихкодыУпаковок --&gt; ШтрихкодыУпаковок</Наименование>
						<Порядок>500</Порядок>
						<Источник Имя="ШтрихкодыУпаковок" Вид="ТабличнаяЧасть"/>
						<Приемник Имя="ШтрихкодыУпаковок" Вид="ТабличнаяЧасть"/>
						<Свойство>
							<Код>21</Код>
							<Наименование>ШтрихкодУпаковки --&gt; ШтрихкодУпаковки</Наименование>
							<Порядок>50</Порядок>
							<Источник Имя="ШтрихкодУпаковки" Вид="Реквизит" Тип="СправочникСсылка.ШтрихкодыУпаковокТоваров"/>
							<Приемник Имя="ШтрихкодУпаковки" Вид="Реквизит" Тип="СправочникСсылка.ШтрихкодыУпаковокТоваров"/>
							<КодПравилаКонвертации>ШтрихкодыУпаковокТоваров                          </КодПравилаКонвертации>
						</Свойство>
						<Свойство>
							<Код>22</Код>
							<Наименование>--&gt; ЗначениеШтрихкода</Наименование>
							<Порядок>100</Порядок>
							<Источник Имя="" Вид=""/>
							<Приемник Имя="ЗначениеШтрихкода" Вид="Реквизит" Тип="Строка"/>
							<ПередВыгрузкой>Значение = ОбъектКоллекции.ШтрихкодУпаковки.ЗначениеШтрихкода;</ПередВыгрузкой>
						</Свойство>
					</Группа>
					<Свойство>
						<Код>23</Код>
						<Наименование>кд_НомерСФ --&gt; кд_НомерСФ</Наименование>
						<Порядок>550</Порядок>
						<Источник Имя="кд_НомерСФ" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>кд_НомерСФ</ИмяПараметраДляПередачи>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>СчетФактураВыданный</Код>
				<Наименование>Документ: Счет-фактура выданный</Наименование>
				<Порядок>150</Порядок>
				<СинхронизироватьПоИдентификатору>true</СинхронизироватьПоИдентификатору>
				<Источник>ДокументСсылка.СчетФактураВыданный</Источник>
				<Приемник>ДокументСсылка.СчетФактураПолученный</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>Дата --&gt; Дата</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="Дата" Вид="Свойство" Тип="Дата"/>
						<Приемник Имя="Дата" Вид="Свойство" Тип="Дата"/>
					</Свойство>
					<Свойство>
						<Код>2</Код>
						<Наименование>ДокументОснование --&gt; ДокументОснование</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="ДокументОснование" Вид="Реквизит"/>
						<Приемник Имя="ДокументОснование" Вид="Реквизит"/>
					</Свойство>
					<Свойство>
						<Код>3</Код>
						<Наименование>Исправление --&gt; Исправление</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="Исправление" Вид="Реквизит" Тип="Булево"/>
						<Приемник Имя="Исправление" Вид="Реквизит" Тип="Булево"/>
					</Свойство>
					<Свойство>
						<Код>4</Код>
						<Наименование>КодВидаОперации --&gt; КодВидаОперации</Наименование>
						<Порядок>200</Порядок>
						<Источник Имя="КодВидаОперации" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="КодВидаОперации" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>5</Код>
						<Наименование>КодВидаОперацииНаУменьшение --&gt; КодВидаОперацииНаУменьшение</Наименование>
						<Порядок>250</Порядок>
						<Источник Имя="КодВидаОперацииНаУменьшение" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="КодВидаОперацииНаУменьшение" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>6</Код>
						<Наименование>Комментарий --&gt; Комментарий</Наименование>
						<Порядок>300</Порядок>
						<Источник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="Комментарий" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>7</Код>
						<Наименование>Контрагент --&gt; Контрагент</Наименование>
						<Порядок>350</Порядок>
						<Источник Имя="Контрагент" Вид="Реквизит"/>
						<Приемник Имя="Контрагент" Вид="Реквизит" Тип="СправочникСсылка.Контрагенты"/>
					</Свойство>
					<Свойство>
						<Код>8</Код>
						<Наименование>КППКонтрагента --&gt; КППКонтрагента</Наименование>
						<Порядок>400</Порядок>
						<Источник Имя="КППКонтрагента" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="КППКонтрагента" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство Поиск="true">
						<Код>9</Код>
						<Наименование>Номер --&gt; Номер</Наименование>
						<Порядок>450</Порядок>
						<Источник Имя="Номер" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Номер" Вид="Свойство" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>10</Код>
						<Наименование>НомерИсправления --&gt; НомерИсправления</Наименование>
						<Порядок>500</Порядок>
						<Источник Имя="НомерИсправления" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="НомерИсправления" Вид="Реквизит" Тип="Число"/>
					</Свойство>
					<Свойство>
						<Код>11</Код>
						<Наименование>Организация --&gt; Организация</Наименование>
						<Порядок>550</Порядок>
						<Источник Имя="Организация" Вид="Реквизит" Тип="СправочникСсылка.Организации"/>
						<Приемник Имя="Организация" Вид="Реквизит" Тип="СправочникСсылка.Организации"/>
						<КодПравилаКонвертации>Организации                                       </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>12</Код>
						<Наименование>Ответственный --&gt; Ответственный</Наименование>
						<Порядок>600</Порядок>
						<Источник Имя="Ответственный" Вид="Реквизит" Тип="СправочникСсылка.Пользователи"/>
						<Приемник Имя="Ответственный" Вид="Реквизит" Тип="СправочникСсылка.Пользователи"/>
						<КодПравилаКонвертации>Пользователи                                      </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>13</Код>
						<Наименование>ПометкаУдаления --&gt; ПометкаУдаления</Наименование>
						<Порядок>650</Порядок>
						<Источник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="ПометкаУдаления" Вид="Свойство" Тип="Булево"/>
					</Свойство>
					<Свойство>
						<Код>14</Код>
						<Наименование>Проведен --&gt; Проведен</Наименование>
						<Порядок>700</Порядок>
						<Источник Имя="Проведен" Вид="Свойство" Тип="Булево"/>
						<Приемник Имя="Проведен" Вид="Свойство" Тип="Булево"/>
					</Свойство>
					<Свойство>
						<Код>15</Код>
						<Наименование>СводныйКорректировочный --&gt; СводныйКорректировочный</Наименование>
						<Порядок>750</Порядок>
						<Источник Имя="СводныйКорректировочный" Вид="Реквизит" Тип="Булево"/>
						<Приемник Имя="СводныйКорректировочный" Вид="Реквизит" Тип="Булево"/>
					</Свойство>
					<Группа>
						<Код>16</Код>
						<Наименование>ДокументыОснования --&gt; ДокументыОснования</Наименование>
						<Порядок>800</Порядок>
						<Источник Имя="ДокументыОснования" Вид="ТабличнаяЧасть"/>
						<Приемник Имя="ДокументыОснования" Вид="ТабличнаяЧасть"/>
						<Свойство>
							<Код>17</Код>
							<Наименование>ДокументОснование --&gt; ДокументОснование</Наименование>
							<Порядок>50</Порядок>
							<Источник Имя="ДокументОснование" Вид="Реквизит"/>
							<Приемник Имя="ДокументОснование" Вид="Реквизит"/>
						</Свойство>
					</Группа>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>ВозвратТоваровПоставщику</Код>
				<Наименование>Документ: Возврат товаров поставщику</Наименование>
				<Порядок>200</Порядок>
				<СинхронизироватьПоИдентификатору>true</СинхронизироватьПоИдентификатору>
				<Источник>ДокументСсылка.ВозвратТоваровПоставщику</Источник>
				<Приемник>ДокументСсылка.ВозвратТоваровПоставщику</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>Дата --&gt; Дата</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="Дата" Вид="Свойство" Тип="Дата"/>
						<Приемник Имя="Дата" Вид="Свойство" Тип="Дата"/>
					</Свойство>
					<Свойство Поиск="true">
						<Код>2</Код>
						<Наименование>Номер --&gt; Номер</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="Номер" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Номер" Вид="Свойство" Тип="Строка"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
		</Группа>
		<Группа>
			<Код>Перечисления</Код>
			<Наименование>Перечисления</Наименование>
			<Порядок>100</Порядок>
			<Правило>
				<Код>кд_МаркетПлейсы</Код>
				<Наименование>Перечисление: Маркет плейсы (кд)</Наименование>
				<Порядок>50</Порядок>
				<Источник>ПеречислениеСсылка.кд_МаркетПлейсы</Источник>
				<Приемник>ПеречислениеСсылка.кд_МаркетПлейсы</Приемник>
				<Свойства/>
				<Значения>
					<Значение>
						<Код>1</Код>
						<Наименование>ВБ --&gt; ВБ</Наименование>
						<Порядок>50</Порядок>
						<Источник>ВБ</Источник>
						<Приемник>ВБ</Приемник>
					</Значение>
					<Значение>
						<Код>2</Код>
						<Наименование>ЯМ --&gt; ЯМ</Наименование>
						<Порядок>100</Порядок>
						<Источник>ЯМ</Источник>
						<Приемник>ЯМ</Приемник>
					</Значение>
				</Значения>
			</Правило>
			<Правило>
				<Код>СтавкиНДС</Код>
				<Наименование>Перечисление: Ставки НДС</Наименование>
				<Порядок>150</Порядок>
				<ПередВыгрузкой>Значение = Перечисления.СтавкиНДС.НДС20</ПередВыгрузкой>
				<Источник>ПеречислениеСсылка.СтавкиНДС</Источник>
				<Приемник>ПеречислениеСсылка.СтавкиНДС</Приемник>
				<Свойства/>
				<Значения>
					<Значение>
						<Код>1</Код>
						<Наименование>БезНДС --&gt; БезНДС</Наименование>
						<Порядок>50</Порядок>
						<Источник>БезНДС</Источник>
						<Приемник>БезНДС</Приемник>
					</Значение>
					<Значение>
						<Код>2</Код>
						<Наименование>НДС0 --&gt; НДС0</Наименование>
						<Порядок>100</Порядок>
						<Источник>НДС0</Источник>
						<Приемник>НДС0</Приемник>
					</Значение>
					<Значение>
						<Код>3</Код>
						<Наименование>НДС10 --&gt; НДС10</Наименование>
						<Порядок>150</Порядок>
						<Источник>НДС10</Источник>
						<Приемник>НДС10</Приемник>
					</Значение>
					<Значение>
						<Код>4</Код>
						<Наименование>НДС10_110 --&gt; НДС10_110</Наименование>
						<Порядок>200</Порядок>
						<Источник>НДС10_110</Источник>
						<Приемник>НДС10_110</Приемник>
					</Значение>
					<Значение>
						<Код>5</Код>
						<Наименование>НДС18 --&gt; НДС18</Наименование>
						<Порядок>250</Порядок>
						<Источник>НДС18</Источник>
						<Приемник>НДС18</Приемник>
					</Значение>
					<Значение>
						<Код>6</Код>
						<Наименование>НДС18_118 --&gt; НДС18_118</Наименование>
						<Порядок>300</Порядок>
						<Источник>НДС18_118</Источник>
						<Приемник>НДС18_118</Приемник>
					</Значение>
					<Значение>
						<Код>7</Код>
						<Наименование>НДС20 --&gt; НДС20</Наименование>
						<Порядок>350</Порядок>
						<Источник>НДС20</Источник>
						<Приемник>НДС20</Приемник>
					</Значение>
					<Значение>
						<Код>8</Код>
						<Наименование>НДС20_120 --&gt; НДС20_120</Наименование>
						<Порядок>400</Порядок>
						<Источник>НДС20_120</Источник>
						<Приемник>НДС20_120</Приемник>
					</Значение>
				</Значения>
			</Правило>
			<Правило>
				<Код>КД_СтатусыЗаказов</Код>
				<Наименование>Перечисление: Статусы заказов (кд)</Наименование>
				<Порядок>200</Порядок>
				<Источник>ПеречислениеСсылка.кд_СтатусыЗаказов</Источник>
				<Приемник>ПеречислениеСсылка.кд_СтатусыЗаказов_МП</Приемник>
				<Свойства/>
				<Значения>
					<Значение>
						<Код>1</Код>
						<Наименование>ВДоставке --&gt; ВДоставке</Наименование>
						<Порядок>50</Порядок>
						<Источник>ВДоставке</Источник>
						<Приемник>ВДоставке</Приемник>
					</Значение>
					<Значение>
						<Код>2</Код>
						<Наименование>Выполнен --&gt; Выполнен</Наименование>
						<Порядок>100</Порядок>
						<Источник>Выполнен</Источник>
						<Приемник>Выполнен</Приемник>
					</Значение>
					<Значение>
						<Код>3</Код>
						<Наименование>Отгрузка --&gt; Отгрузка</Наименование>
						<Порядок>150</Порядок>
						<Источник>Отгрузка</Источник>
						<Приемник>Отгрузка</Приемник>
					</Значение>
					<Значение>
						<Код>4</Код>
						<Наименование>Отменен --&gt; Отменен</Наименование>
						<Порядок>200</Порядок>
						<Источник>Отменен</Источник>
						<Приемник>Отменен</Приемник>
					</Значение>
					<Значение>
						<Код>5</Код>
						<Наименование>Принят --&gt; Принят</Наименование>
						<Порядок>250</Порядок>
						<Источник>Принят</Источник>
						<Приемник>Принят</Приемник>
					</Значение>
				</Значения>
			</Правило>
		</Группа>
		<Группа>
			<Код>Справочники</Код>
			<Наименование>Справочники</Наименование>
			<Порядок>150</Порядок>
			<Правило>
				<Код>Склады</Код>
				<Наименование>Справочник: Склады</Наименование>
				<Порядок>50</Порядок>
				<ПоследовательностьПолейПоиска>ПрекратитьПоиск = Истина;
КодМагазинаНаСайте = СвойстваПоиска.Получить("Код");
Если ЗначениеЗаполнено(КодМагазинаНаСайте) ТОгда
	Попытка 
		КодМагазинаНаСайте = Число(КодМагазинаНаСайте);
	Исключение
		КодМагазинаНаСайте = 0;
	КонецПопытки;
КонецЕсли;
	
Если ЗначениеЗаполнено(КодМагазинаНаСайте) ТОгда
	Запрос = Новый Запрос(
	"
	|выбрать т.ОсновнойСклад из регистрСведений.СоответствиеМагазинов как т
	|где т.КодМагазинаНаСайте = &amp;КодМагазинаНаСайте
	|");
	Запрос.УстановитьПараметр("КодМагазинаНаСайте", КодМагазинаНаСайте);
	Выборка = Запрос.Выполнить().Выбрать();
	Если Выборка.Следующий() Тогда
		СсылкаНаОбъект = Выборка.ОсновнойСклад;
	КонецЕсли;
КонецЕсли;</ПоследовательностьПолейПоиска>
				<НеЗамещать>true</НеЗамещать>
				<НеЗапоминатьВыгруженные>true</НеЗапоминатьВыгруженные>
				<НеВыгружатьОбъектыСвойствПоСсылкам>true</НеВыгружатьОбъектыСвойствПоСсылкам>
				<НеСоздаватьЕслиНеНайден>true</НеСоздаватьЕслиНеНайден>
				<Источник>СправочникСсылка.Склады</Источник>
				<Приемник>СправочникСсылка.Склады</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>2</Код>
						<Наименование>кд_интернетНомерСклада --&gt; Код</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="кд_интернетНомерСклада" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>Валюты</Код>
				<Наименование>Справочник: Валюты</Наименование>
				<Порядок>100</Порядок>
				<НеЗамещать>true</НеЗамещать>
				<НеСоздаватьЕслиНеНайден>true</НеСоздаватьЕслиНеНайден>
				<Источник>СправочникСсылка.Валюты</Источник>
				<Приемник>СправочникСсылка.Валюты</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>Код --&gt; Код</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="Код" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>Номенклатура</Код>
				<Наименование>Справочник: Номенклатура</Наименование>
				<Порядок>150</Порядок>
				<ПоследовательностьПолейПоиска>КодНоменклатуры = СвойстваПоиска.Получить("Код");
КодНоменклатуры = ОбменССайтомПривелигированный.ВернутьРусскийПрефикс(КодНоменклатуры);
СвойстваПоиска.Вставить("Код", КодНоменклатуры);</ПоследовательностьПолейПоиска>
				<НеЗамещать>true</НеЗамещать>
				<НеЗапоминатьВыгруженные>true</НеЗапоминатьВыгруженные>
				<НеСоздаватьЕслиНеНайден>true</НеСоздаватьЕслиНеНайден>
				<Источник>СправочникСсылка.Номенклатура</Источник>
				<Приемник>СправочникСсылка.Номенклатура</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>2</Код>
						<Наименование>Код --&gt; Код</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="Код" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
						<ПередВыгрузкой>Значение = СокрЛП(Источник.Код);
Значение = Лев(Значение, стрДлина(Значение) - 2);</ПередВыгрузкой>
					</Свойство>
					<Свойство>
						<Код>3</Код>
						<Наименование>Наименование --&gt; Наименование</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>ХарактеристикиНоменклатуры</Код>
				<Наименование>Справочник: Характеристики номенклатуры</Наименование>
				<Порядок>200</Порядок>
				<НеЗамещать>true</НеЗамещать>
				<НеСоздаватьЕслиНеНайден>true</НеСоздаватьЕслиНеНайден>
				<Источник>СправочникСсылка.Номенклатура</Источник>
				<Приемник>СправочникСсылка.ХарактеристикиНоменклатуры</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>--&gt; Код</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
						<ПередВыгрузкой>Значение = СокрЛП(Источник.Код);
Значение = Прав(Значение, 2);</ПередВыгрузкой>
					</Свойство>
					<Свойство Поиск="true">
						<Код>2</Код>
						<Наименование>--&gt; Владелец</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Владелец" Вид="Свойство" Тип="СправочникСсылка.Номенклатура"/>
						<КодПравилаКонвертации>Номенклатура                                      </КодПравилаКонвертации>
						<ПередВыгрузкой>Значение = Источник;</ПередВыгрузкой>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>ШтрихкодыУпаковокТоваров</Код>
				<Наименование>Справочник: Штрихкоды упаковок и товаров</Наименование>
				<Порядок>250</Порядок>
				<ПоследовательностьПолейПоиска>Если СвойстваПоиска["Характеристика"] = неопределено тогда
	СвойстваПоиска.Вставить("Характеристика", Справочники.ХарактеристикиНоменклатуры.ПустаяСсылка());
КонецЕсли;</ПоследовательностьПолейПоиска>
				<НеЗамещать>true</НеЗамещать>
				<НеЗапоминатьВыгруженные>true</НеЗапоминатьВыгруженные>
				<СинхронизироватьПоИдентификатору>true</СинхронизироватьПоИдентификатору>
				<ПродолжитьПоискПоПолямПоискаЕслиПоИдентификаторуНеНашли>true</ПродолжитьПоискПоПолямПоискаЕслиПоИдентификаторуНеНашли>
				<НеСоздаватьЕслиНеНайден>true</НеСоздаватьЕслиНеНайден>
				<ПриПереносеОбъектаПоСсылкеУстанавливатьТолькоGIUD>true</ПриПереносеОбъектаПоСсылкеУстанавливатьТолькоGIUD>
				<Источник>СправочникСсылка.ШтрихкодыУпаковокТоваров</Источник>
				<Приемник>СправочникСсылка.ШтрихкодыУпаковокТоваров</Приемник>
				<Свойства>
					<Свойство Поиск="true">
						<Код>1</Код>
						<Наименование>ЗначениеШтрихкода --&gt; ЗначениеШтрихкода</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="ЗначениеШтрихкода" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="ЗначениеШтрихкода" Вид="Реквизит" Тип="Строка"/>
					</Свойство>
					<Свойство Поиск="true">
						<Код>2</Код>
						<Наименование>Номенклатура --&gt; Номенклатура</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="Номенклатура" Вид="Реквизит" Тип="СправочникСсылка.Номенклатура"/>
						<Приемник Имя="Номенклатура" Вид="Реквизит" Тип="СправочникСсылка.Номенклатура"/>
						<КодПравилаКонвертации>Номенклатура                                      </КодПравилаКонвертации>
					</Свойство>
					<Свойство Поиск="true">
						<Код>3</Код>
						<Наименование>Номенклатура --&gt; Характеристика</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="Номенклатура" Вид="Реквизит" Тип="СправочникСсылка.Номенклатура"/>
						<Приемник Имя="Характеристика" Вид="Реквизит" Тип="СправочникСсылка.ХарактеристикиНоменклатуры"/>
						<КодПравилаКонвертации>ХарактеристикиНоменклатуры                        </КодПравилаКонвертации>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>Контрагенты</Код>
				<Наименование>Справочник: Контрагенты</Наименование>
				<Порядок>300</Порядок>
				<СинхронизироватьПоИдентификатору>true</СинхронизироватьПоИдентификатору>
				<Источник>СправочникСсылка.Контрагенты</Источник>
				<Приемник>СправочникСсылка.Контрагенты</Приемник>
				<Свойства>
					<Свойство>
						<Код>1</Код>
						<Наименование>Наименование --&gt; Наименование</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
					</Свойство>
					<Свойство Поиск="true" Обязательное="true">
						<Код>2</Код>
						<Наименование>--&gt; ЭтоГруппа</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ЭтоГруппа" Вид="Свойство" Тип="Булево"/>
					</Свойство>
					<Свойство Поиск="true">
						<Код>3</Код>
						<Наименование>--&gt; Код</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>Организации</Код>
				<Наименование>Справочник: Организации</Наименование>
				<Порядок>350</Порядок>
				<СинхронизироватьПоИдентификатору>true</СинхронизироватьПоИдентификатору>
				<Источник>СправочникСсылка.Организации</Источник>
				<Приемник>СправочникСсылка.Организации</Приемник>
				<Свойства>
					<Свойство>
						<Код>1</Код>
						<Наименование>Наименование --&gt; Наименование</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
					</Свойство>
					<Свойство Поиск="true" Обязательное="true">
						<Код>2</Код>
						<Наименование>--&gt; ЭтоГруппа</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ЭтоГруппа" Вид="Свойство" Тип="Булево"/>
					</Свойство>
					<Свойство Поиск="true">
						<Код>3</Код>
						<Наименование>--&gt; Код</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>Пользователи</Код>
				<Наименование>Справочник: Пользователи</Наименование>
				<Порядок>400</Порядок>
				<СинхронизироватьПоИдентификатору>true</СинхронизироватьПоИдентификатору>
				<Источник>СправочникСсылка.Пользователи</Источник>
				<Приемник>СправочникСсылка.Пользователи</Приемник>
				<Свойства>
					<Свойство>
						<Код>1</Код>
						<Наименование>Наименование --&gt; Наименование</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
						<Приемник Имя="Наименование" Вид="Свойство" Тип="Строка"/>
					</Свойство>
					<Свойство Поиск="true" Обязательное="true">
						<Код>2</Код>
						<Наименование>--&gt; ЭтоГруппа</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ЭтоГруппа" Вид="Свойство" Тип="Булево"/>
					</Свойство>
					<Свойство Поиск="true">
						<Код>3</Код>
						<Наименование>--&gt; Код</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Код" Вид="Свойство" Тип="Строка"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
		</Группа>
		<Группа>
			<Код>Регистры сведений</Код>
			<Наименование>Регистры сведений</Наименование>
			<Порядок>200</Порядок>
			<Правило>
				<Код>КД_МПВБЗаказПокупателя</Код>
				<Наименование>Регистр сведений: КД_МПВБЗаказПокупателя</Наименование>
				<Порядок>25</Порядок>
				<НеЗапоминатьВыгруженные>true</НеЗапоминатьВыгруженные>
				<Приемник>РегистрСведенийЗапись.КД_МПВБЗаказПокупателя</Приемник>
				<Свойства>
					<Свойство>
						<Код>1</Код>
						<Наименование>--&gt; ЗаказПокупателя</Наименование>
						<Порядок>50</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ЗаказПокупателя" Вид="Измерение" Тип="ДокументСсылка.ЗаказПокупателя"/>
						<КодПравилаКонвертации>ЗаказПокупателя</КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>2</Код>
						<Наименование>Номенклатура --&gt; Номенклатура</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="Номенклатура" Вид="Реквизит" Тип="СправочникСсылка.Номенклатура"/>
						<Приемник Имя="Номенклатура" Вид="Измерение" Тип="СправочникСсылка.Номенклатура"/>
						<КодПравилаКонвертации>Номенклатура</КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>3</Код>
						<Наименование>КодСтроки --&gt; КодСтроки</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="КодСтроки" Вид="Реквизит" Тип="Число"/>
						<Приемник Имя="КодСтроки" Вид="Измерение" Тип="Число"/>
					</Свойство>
					<Свойство>
						<Код>4</Код>
						<Наименование>СРИД --&gt; СРИД</Наименование>
						<Порядок>200</Порядок>
						<Источник Имя="СРИД" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="СРИД" Вид="Ресурс" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>5</Код>
						<Наименование>НомерСборочногоЗадания --&gt; НомерСборочногоЗадания</Наименование>
						<Порядок>250</Порядок>
						<Источник Имя="НомерСборочногоЗадания" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="НомерСборочногоЗадания" Вид="Ресурс" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>6</Код>
						<Наименование>СтикерЗначение --&gt; Стикер</Наименование>
						<Порядок>300</Порядок>
						<Источник Имя="СтикерЗначение" Вид="Реквизит" Тип="Строка"/>
						<Приемник Имя="Стикер" Вид="Ресурс" Тип="Строка"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>КД_КартинкиИФайлы</Код>
				<Наименование>:</Наименование>
				<Порядок>50</Порядок>
				<ПослеЗагрузки>Если не ПараметрыОбъекта = неопределено тогда

	ДвоичныеДанные = ПараметрыОбъекта["ДвоичныеДанные"].Получить();
	Расширение = ПараметрыОбъекта["Расширение"];

	ТекДата = ТекущаяДата();
	ДопСтрока = Строка(Час(ТекДата)) + Строка(Минута(ТекДата)) + Строка(Секунда(ТекДата));	
	ИдентификаторФайла = Лев(Объект.Идентификатор, 38) + "_" + ДопСтрока + Расширение;
	Струк = Обработки.КД_РаботаСФайлами.ПолучитьПуть();
	
	Обработки.КД_РаботаСФайлами.ЗаписатьФайлВПапку(Объект.Объект, ДвоичныеДанные, Объект.Идентификатор, Расширение, ИдентификаторФайла, Струк, ТекДата);

КонецЕсли;

Отказ = Истина;</ПослеЗагрузки>
				<НеЗапоминатьВыгруженные>true</НеЗапоминатьВыгруженные>
				<Приемник>РегистрСведенийЗапись.КД_КартинкиИФайлы</Приемник>
				<Свойства>
					<Свойство>
						<Код>1</Код>
						<Наименование>--&gt; Объект</Наименование>
						<Порядок>50</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Объект" Вид="Измерение"/>
						<КодПравилаКонвертации>ЗаказПокупателя                                   </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>2</Код>
						<Наименование>--&gt; Идентификатор</Наименование>
						<Порядок>100</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="Идентификатор" Вид="Измерение" Тип="Строка"/>
					</Свойство>
					<Свойство>
						<Код>3</Код>
						<Наименование>--&gt; ДатаСохранения</Наименование>
						<Порядок>150</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="ДатаСохранения" Вид="Ресурс" Тип="Дата"/>
					</Свойство>
					<Свойство>
						<Код>4</Код>
						<Наименование>--&gt; ДвоичныеДанные</Наименование>
						<Порядок>200</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>ДвоичныеДанные</ИмяПараметраДляПередачи>
					</Свойство>
					<Свойство>
						<Код>5</Код>
						<Наименование>--&gt; Расширение</Наименование>
						<Порядок>250</Порядок>
						<ПолучитьИзВходящихДанных>true</ПолучитьИзВходящихДанных>
						<Источник Имя="" Вид=""/>
						<Приемник Имя="" Вид=""/>
						<ИмяПараметраДляПередачи>Расширение</ИмяПараметраДляПередачи>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
			<Правило>
				<Код>КурсыВалют</Код>
				<Наименование>Регистр сведений: Курсы валют</Наименование>
				<Порядок>100</Порядок>
				<НеЗапоминатьВыгруженные>true</НеЗапоминатьВыгруженные>
				<Источник>РегистрСведенийЗапись.КурсыВалют</Источник>
				<Приемник>РегистрСведенийЗапись.КурсыВалют</Приемник>
				<Свойства>
					<Свойство>
						<Код>1</Код>
						<Наименование>Валюта --&gt; Валюта</Наименование>
						<Порядок>50</Порядок>
						<Источник Имя="Валюта" Вид="Измерение" Тип="СправочникСсылка.Валюты"/>
						<Приемник Имя="Валюта" Вид="Измерение" Тип="СправочникСсылка.Валюты"/>
						<КодПравилаКонвертации>Валюты                                            </КодПравилаКонвертации>
					</Свойство>
					<Свойство>
						<Код>2</Код>
						<Наименование>Кратность --&gt; Кратность</Наименование>
						<Порядок>100</Порядок>
						<Источник Имя="Кратность" Вид="Ресурс" Тип="Число"/>
						<Приемник Имя="Кратность" Вид="Ресурс" Тип="Число"/>
					</Свойство>
					<Свойство>
						<Код>3</Код>
						<Наименование>Курс --&gt; Курс</Наименование>
						<Порядок>150</Порядок>
						<Источник Имя="Курс" Вид="Ресурс" Тип="Число"/>
						<Приемник Имя="Курс" Вид="Ресурс" Тип="Число"/>
					</Свойство>
					<Свойство>
						<Код>5</Код>
						<Наименование>Период --&gt; Период</Наименование>
						<Порядок>250</Порядок>
						<Источник Имя="Период" Вид="Свойство" Тип="Дата"/>
						<Приемник Имя="Период" Вид="Свойство" Тип="Дата"/>
					</Свойство>
				</Свойства>
				<Значения/>
			</Правило>
		</Группа>
	</ПравилаКонвертацииОбъектов>
	<ПравилаВыгрузкиДанных>
		<Группа Отключить="false">
			<Код>Документы</Код>
			<Наименование>Документы</Наименование>
			<Порядок>50</Порядок>
			<Правило Отключить="false">
				<Код>КорректировкаЗаказаПокупателя</Код>
				<Наименование>ЗаказКлиента</Наименование>
				<Порядок>50</Порядок>
				<КодПравилаКонвертации>КорректировкаЗаказаПокупателя                     </КодПравилаКонвертации>
				<СпособОтбораДанных>СтандартнаяВыборка</СпособОтбораДанных>
				<ОбъектВыборки>ДокументСсылка.ЗаказКлиента</ОбъектВыборки>
				<ПередВыгрузкойОбъекта>Если Объект.Проведен = ЛОЖЬ или Объект.ПометкаУдаления = ИСТИНА  Тогда
	Отказ = Истина;	
Конецесли; 

//changed+ Долгих Н. 02.06.2025 

//если Объект.кд_СтатусЗаказа = Перечисления.кд_СтатусыЗаказов.Отгрузка Тогда
//	Отказ = Истина;
//конецесли;

//changed+ Долгих Н. 02.06.2025

кд_ЭтоКорректировка = ЗначениеЗаполнено(Объект.кд_ЗаказОснование);
Если НЕ кд_ЭтоКорректировка Тогда
	ВыгрузитьПоПравилу(Объект,,,, "ЗаказПокупателя",,,,,,,,,,);
	Отказ = Истина;
КонецЕсли;
//changed-</ПередВыгрузкойОбъекта>
			</Правило>
			<Правило Отключить="false">
				<Код>ЗаказКлиента</Код>
				<Наименование>ЗаказКлиента</Наименование>
				<Порядок>50</Порядок>
				<КодПравилаКонвертации>ЗаказПокупателя                                   </КодПравилаКонвертации>
				<СпособОтбораДанных>СтандартнаяВыборка</СпособОтбораДанных>
				<ОбъектВыборки>ДокументСсылка.ЗаказКлиента</ОбъектВыборки>
				<ПередВыгрузкойОбъекта>Если Объект.Проведен = ЛОЖЬ или Объект.ПометкаУдаления = ИСТИНА  Тогда
	Отказ = Истина;	
Конецесли; 

//changed+ Долгих Н. 02.06.2025 

если Объект.кд_СтатусЗаказа = Перечисления.кд_СтатусыЗаказов.Отгрузка Тогда
	Отказ = Истина;
конецесли;
//changed+ Долгих Н. 02.06.2025

кд_ЭтоКорректировка = ЗначениеЗаполнено(Объект.кд_ЗаказОснование);
Если кд_ЭтоКорректировка Тогда
	ВыгрузитьПоПравилу(Объект,,,, "КорректировкаЗаказаПокупателя",,,,,,,,,,);
	Отказ = Истина;
КонецЕсли;
//changed-</ПередВыгрузкойОбъекта>
			</Правило>
			<Правило Отключить="false">
				<Код>РеализацияТоваровУслуг</Код>
				<Наименование>РеализацияТоваровУслуг</Наименование>
				<Порядок>100</Порядок>
				<КодПравилаКонвертации>РеализацияТоваровУслуг                            </КодПравилаКонвертации>
				<СпособОтбораДанных>СтандартнаяВыборка</СпособОтбораДанных>
				<ОбъектВыборки>ДокументСсылка.РеализацияТоваровУслуг</ОбъектВыборки>
			</Правило>
		</Группа>
		<Группа Отключить="false">
			<Код>Справочники</Код>
			<Наименование>Справочники</Наименование>
			<Порядок>100</Порядок>
			<Правило Отключить="true">
				<Код>ЗаказКлиентаПрисоединенныеФайлы</Код>
				<Наименование>ЗаказКлиентаПрисоединенныеФайлы</Наименование>
				<Порядок>50</Порядок>
				<КодПравилаКонвертации>КД_КартинкиИФайлы                                 </КодПравилаКонвертации>
				<СпособОтбораДанных>СтандартнаяВыборка</СпособОтбораДанных>
				<ОбъектВыборки>СправочникСсылка.ЗаказКлиентаПрисоединенныеФайлы</ОбъектВыборки>
				<ПередВыгрузкойОбъекта>//Запрос = Новый Запрос("выбрать * из регистрСведений.КурсыВалют как т где т.Период &gt;= &amp;ТекДата");
//Запрос.УстановитьПараметр("ТекДата", НачалоДня(ТекущаяДата()));
//выборка = Запрос.выполнить().Выбрать();
//Пока выборка.Следующий() Цикл
//	ВыгрузитьПоПравилу(выборка,,,, "КурсыВалют",,,,,,,,,,);
//КонецЦикла;

стрВходящиеДанные = Новый Структура;
стрВходящиеДанные.Вставить("Объект", Объект.ВладелецФайла);
стрВходящиеДанные.Вставить("ДатаСохранения", Объект.ДатаСоздания);
стрВходящиеДанные.Вставить("Идентификатор", Объект.Наименование);
стрВходящиеДанные.Вставить("ДвоичныеДанные", Объект.ФайлХранилище);
стрВходящиеДанные.Вставить("Расширение", Объект.Расширение);

ВыгрузитьПоПравилу(стрВходящиеДанные,,стрВходящиеДанные,, "КД_КартинкиИФайлы",,,,,,,,,,);
Отказ = Истина;</ПередВыгрузкойОбъекта>
			</Правило>
		</Группа>
	</ПравилаВыгрузкиДанных>
	<ПравилаОчисткиДанных/>
	<Алгоритмы>
		<Алгоритм Имя="ВременнаяОтменаПроведенияСвязаннойРеализации" ИспользуетсяПриЗагрузке="true">
			<Текст>
Если ЗначениеЗаполнено(Объект.Ссылка) Тогда
	Запрос = Запросы.ПолучитьДанныеДляОтложенногоПроведения;
	Запрос.УстановитьПараметр("Сделка", Объект.Ссылка);
	Результат = Запрос.Выполнить();
	Выборка = Результат.Выбрать();
	Пока Выборка.Следующий() Цикл  
		ДокументСсылка = Выборка.Реализация;
		Выполнить(Алгоритмы.ОбработатьДокументВыборки);  
		ДокументСсылка = Выборка.СчетФактура;
		Выполнить(Алгоритмы.ОбработатьДокументВыборки);  
	КонецЦикла;
КонецЕсли;</Текст>
		</Алгоритм>
		<Алгоритм Имя="ВыполнитьОтложенноеПроведениеДокументов" ИспользуетсяПриЗагрузке="true">
			<Текст>	
Если не ДокументыДляОтложенногоПроведения().Количество() = 0 Тогда
	
	// сворачиваем таблицу по уникальным полям
	ДокументыДляОтложенногоПроведения().Свернуть("ДокументСсылка, ДатаДокумента, ДокументПроведенУспешно", "ЭтоКоллизия");
	
	// сортируем документы по возрастанию даты документов
	ДокументыДляОтложенногоПроведения().Сортировать("ДатаДокумента");
	
	// инициализируем колонку результата проведения документа
	ДокументыДляОтложенногоПроведения().ЗаполнитьЗначения(Ложь, "ДокументПроведенУспешно");
	
	Для Каждого СтрокаТаблицы Из ДокументыДляОтложенногоПроведения() Цикл
		
		Если СтрокаТаблицы.ДокументСсылка.Пустая() Тогда
			Продолжить;
		КонецЕсли;
		
		Объект = СтрокаТаблицы.ДокументСсылка.ПолучитьОбъект();
		
		Если Объект = Неопределено или Объект.Проведен Тогда
			Продолжить;
		КонецЕсли;     
		
		//Сообщить("Объект = " + Объект);
		
		// устанавливаем узел-отправитель для предотвращения регистрации объекта на узле, для которого производим загрузку
		// проведение выполняем не в режиме загрузки
		УстановитьОбменДаннымиЗагрузка(Объект, Ложь);
		
		ОписаниеОшибки = "";
		
		Попытка
			
			Объект.ДополнительныеСвойства.Вставить("ОтложенноеПроведение");
			Объект.ДополнительныеСвойства.Вставить("ЗаписьВРежимеОбменаДанными", Истина);
			
			//ЗаписьЖурналаРегистрацииОбменДанными("ЗаписьВРежимеОбменаДанными установлена", УровеньЖурналаРегистрации.Предупреждение);
			//ЗаписьЖурналаРегистрацииОбменДанными("ПроверитьЗаполнение = " + Объект.ПроверитьЗаполнение(), УровеньЖурналаРегистрации.Предупреждение);
			
			Если Объект.ПроверитьЗаполнение() Тогда
				
				// При проведении документа снимаем запрет на выполнение ПРО,
				// т.к. ПРО были проигнорированы при обычной записи документа с целью оптимизации скорости загрузки данных.
				Если Объект.ДополнительныеСвойства.Свойство("ОтключитьМеханизмРегистрацииОбъектов") Тогда
					Объект.ДополнительныеСвойства.Удалить("ОтключитьМеханизмРегистрацииОбъектов");
				КонецЕсли;
				
				Объект.ДополнительныеСвойства.Вставить("ПропуститьПроверкуЗапретаИзменения");
				
				Если СтрокаТаблицы.ЭтоКоллизия &gt; 0 И ИспользуетсяВерсионирование() Тогда
					
					// Заполняем данные создаваемой версии
					Объект.ДополнительныеСвойства.Вставить("ЭтоВерсияОбмена", Истина);
					Объект.ДополнительныеСвойства.Вставить("ТипВерсииОбъекта", Перечисления["ТипыВерсийОбъекта"].ПринятыеДанныеПоКоллизии);
					Объект.ДополнительныеСвойства.Вставить("АвторВерсии", УзелОбменаЗагрузкаДанных);
					Объект.ДополнительныеСвойства.Вставить("Комментарий", НСтр("ru = 'Версия получена из другой программы.'"));
					
				КонецЕсли;    
				
				//ЗаписьЖурналаРегистрацииОбменДанными("Начинаем проведение документа " + СокрЛП(Объект), УровеньЖурналаРегистрации.Предупреждение);  
				
				// выполняем попытку проведения документа
				Объект.Записать(РежимЗаписиДокумента.Проведение);   
				
				//ЗаписьЖурналаРегистрацииОбменДанными("УСПЕХ!!!!", УровеньЖурналаРегистрации.Предупреждение);  
				
				СтрокаТаблицы.ДокументПроведенУспешно = Объект.Проведен;
				
			Иначе
				
				СтрокаТаблицы.ДокументПроведенУспешно = Ложь;
				
				ОписаниеОшибки = НСтр("ru = 'Ошибка заполнения реквизитов документа'");
				
			КонецЕсли;
			
		Исключение
			
			//ОписаниеОшибки = КраткоеПредставлениеОшибки(ИнформацияОбОшибке());   
			//ОписаниеОшибки = ИнформацияОбОшибке();   
			ОписаниеОшибки = ОписаниеОшибки();   
			СтрокаТаблицы.ДокументПроведенУспешно = Ложь;
			
		КонецПопытки;
		
		// если документ провести не удалось фиксируем ошибку в ЖР
		Если Не СтрокаТаблицы.ДокументПроведенУспешно Тогда
			
			СтрокаСообщения = НСтр("ru = 'Ошибка при отложенном проведении документа: %1. Описание ошибки: %2'",
				ОбщегоНазначенияКлиентСервер.КодОсновногоЯзыка());
			СтрокаСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(СтрокаСообщения, Строка(Объект), ОписаниеОшибки);
			ЗаписьЖурналаРегистрацииОбменДанными(СтрокаСообщения, УровеньЖурналаРегистрации.Предупреждение);
			
			СообщенияПользователю = ПолучитьСообщенияПользователю(Истина);
			ТекстОшибки = "";
			Для Каждого Сообщение Из СообщенияПользователю Цикл
				ТекстОшибки = ТекстОшибки + Сообщение.Текст + Символы.ПС;
			КонецЦикла;
			
			РегистрыСведений.РезультатыОбменаДанными.ЗарегистрироватьОшибкуПроверкиОбъекта(СтрокаТаблицы.ДокументСсылка, УзелОбменаЗагрузкаДанных,
				Объект.Метаданные().Синоним, ТекстОшибки, Перечисления.ТипыПроблемОбменаДанными.НепроведенныйДокумент);
			
		КонецЕсли;
		
	КонецЦикла;
	
ДокументыДляОтложенногоПроведения().Очистить();
КонецЕсли;</Текст>
		</Алгоритм>
		<Алгоритм Имя="ОбработатьДокументВыборки" ИспользуетсяПриЗагрузке="true">
			<Текст>
Если ЗначениеЗаполнено(ДокументСсылка) Тогда
	ДокументОбъект = ДокументСсылка.ПолучитьОбъект(); 
	ДокументОбъект.Проведен = Ложь; 
	
	Для ИндексДвижений = 1 По ДокументОбъект.Движения.Количество() Цикл
		ДокументОбъект.Движения[ИндексДвижений - 1].Очистить();
	КонецЦикла; 
	
	ДокументОбъект.ОбменДанными.Загрузка = Истина;
	Попытка
		//ДокументОбъект.Записать(РежимЗаписиДокумента.ОтменаПроведения); 
		ДокументОбъект.Записать(РежимЗаписиДокумента.Запись); 
		ОтменаПроведенияПрошлаУспешно = Истина;
	Исключение   
		ОтменаПроведенияПрошлаУспешно = Ложь;
		ОписаниеОшибки = КраткоеПредставлениеОшибки(ИнформацияОбОшибке());
		ЗаписьЖурналаРегистрацииОбменДанными("Отмена проведения документа " + СокрЛП(Выборка.Ссылка) + " не удачна: " + ОписаниеОшибки, УровеньЖурналаРегистрации.Предупреждение);
	КонецПопытки;   
	
	Если ОтменаПроведенияПрошлаУспешно Тогда 
		СтрокаТаблицы = Параметры.ДокументыДляОтложенногоПроведенияДоп.Добавить();
		СтрокаТаблицы.ДокументСсылка = ДокументОбъект.Ссылка;
		СтрокаТаблицы.ДатаДокумента  = ДокументОбъект.Дата;
		СтрокаТаблицы.ЭтоКоллизия 	 = Ложь;    
	КонецЕсли;
КонецЕсли;</Текст>
			<Параметры>ДокументСсылка</Параметры>
		</Алгоритм>
		<Алгоритм Имя="СозданиеЗаказа_п41" ИспользуетсяПриЗагрузке="true">
			<Текст>Если не ЗначениеЗаполнено(Объект.Дата) Тогда
	Объект.Дата = ТекущаяДатаСеанса();
КонецЕсли;

Объект.КаналСбыта = Параметры.КаналСбыта;

Если не ПараметрыОбъекта = неопределено ТОгда
	КодМагазинаНаСайте = ПараметрыОбъекта.Получить("кд_интернетНомерСклада");
	Если ЗначениеЗаполнено(КодМагазинаНаСайте) ТОгда
		Запрос = Новый Запрос(
		"
		|выбрать т.Подразделение, т.ОсновнойСклад из регистрСведений.СоответствиеМагазинов как т
		|где т.КодМагазинаНаСайте = &amp;КодМагазинаНаСайте и не т.Служебная = Истина
		|");
		Запрос.УстановитьПараметр("КодМагазинаНаСайте", КодМагазинаНаСайте);
		Выборка = Запрос.Выполнить().Выбрать();
		Если Выборка.Следующий() Тогда
			Объект.Подразделение = Выборка.Подразделение;
			Объект.Склад = Выборка.ОсновнойСклад;
		КонецЕсли;
	КонецЕсли;
КонецЕсли;

Объект.Организация = параметры.Организация;
Объект.Контрагент = параметры.Контрагент;
Объект.ДоговорКонтрагента = параметры.ДоговорКонтрагента;
текТипЦен = Параметры.ТипЦен;

Объект.ФормаОплаты = перечисления.ФормаОплаты.Безналичный;
Объект.СуммаВключаетНДС = Истина;
Объект.УчитыватьНДС = Истина;
Объект.КратностьВзаиморасчетов = 1;
Объект.КурсВзаиморасчетов = 1;
Объект.ТипЦен = текТипЦен;

Для каждого строкаТЧ из Объект.Товары Цикл
	текХарактеристика = СтрокаТЧ.ХарактеристикаНоменклатуры;
	ОбработкаТабличныхЧастей.ПриИзмененииНоменклатурыТабЧасти(строкаТЧ, Объект);
	//ОбработкаТабличныхЧастей.ЗаполнитьЕдиницуЦенуПродажиТабЧасти(строкаТЧ, Объект, Параметры.ВалютаРегламентированногоУчета); 
		ОбработкаТабличныхЧастей.ЗаполнитьСтавкуНДСТабЧасти(строкаТЧ, Объект); 
		ОбработкаТабличныхЧастей.РассчитатьСуммуТабЧасти(строкаТЧ, Объект);
		ОбработкаТабличныхЧастей.РассчитатьСуммуНДСТабЧасти(строкаТЧ, Объект);
	Если СтрокаТЧ.Номенклатура.ВестиУчетПоХарактеристикам Тогда
		СтрокаТЧ.ХарактеристикаНоменклатуры = текХарактеристика;
	КонецЕсли;
	СтрокаТЧ.Размещение = Объект.Склад;
КонецЦикла;

Объект.СуммаДокумента = Объект.товары.Итог("Сумма") + Объект.Услуги.Итог("Сумма");</Текст>
		</Алгоритм>
		<Алгоритм Имя="СозданиеПТиУ_п411" ИспользуетсяПриЗагрузке="true">
			<Текст>Если не ЗначениеЗаполнено(Объект.Дата) Тогда
	Объект.Дата = ТекущаяДатаСеанса();
КонецЕсли;

Если не ПараметрыОбъекта = неопределено ТОгда
	КодМагазинаНаСайте = ПараметрыОбъекта.Получить("кд_интернетНомерСклада"); 
	НомерСчетаФактуры = ПараметрыОбъекта.Получить("кд_НомерСФ");
	Если ЗначениеЗаполнено(КодМагазинаНаСайте) ТОгда
		Запрос = Новый Запрос(
		"
		|выбрать т.Подразделение, т.ОсновнойСклад из регистрСведений.СоответствиеМагазинов как т
		|где т.КодМагазинаНаСайте = &amp;КодМагазинаНаСайте и не т.Служебная = Истина
		|");
		Запрос.УстановитьПараметр("КодМагазинаНаСайте", КодМагазинаНаСайте);
		Выборка = Запрос.Выполнить().Выбрать();
		Если Выборка.Следующий() Тогда
			Объект.Подразделение = Выборка.Подразделение;
			Объект.СкладОрдер = Выборка.ОсновнойСклад;
		КонецЕсли;
	КонецЕсли;
КонецЕсли;

Объект.Организация = параметры.Организация;
Объект.Контрагент = параметры.Контрагент;
Объект.ДоговорКонтрагента = параметры.ДоговорКонтрагентаВозврат;

//Объект.ФормаОплаты = перечисления.ФормаОплаты.Безналичный;
Объект.СуммаВключаетНДС = Истина;
Объект.УчитыватьНДС = Истина;
Объект.ОтражатьВБухгалтерскомУчете = Истина;
Объект.КратностьВзаиморасчетов = 1;
Объект.КурсВзаиморасчетов = 1;

Объект.ВидПоступления = Перечисления.ВидыПоступленияТоваров.НаСклад;
Объект.ОтражатьВУправленческомУчете = Истина; 
Объект.ОтражатьВБухгалтерскомУчете = Истина; 
Объект.ОтражатьВНалоговомУчете = Истина; 

Для каждого строкаТЧ из Объект.Товары Цикл
	текХарактеристика = СтрокаТЧ.ХарактеристикаНоменклатуры;
	ОбработкаТабличныхЧастей.ПриИзмененииНоменклатурыТабЧасти(строкаТЧ, Объект);
	ОбработкаТабличныхЧастей.ЗаполнитьЕдиницуЦенуПродажиТабЧасти(строкаТЧ, Объект, Параметры.ВалютаРегламентированногоУчета); 
	Если СтрокаТЧ.Номенклатура.ВестиУчетПоХарактеристикам Тогда
		СтрокаТЧ.ХарактеристикаНоменклатуры = текХарактеристика;
	КонецЕсли;
	СтрокаТЧ.Склад = Объект.СкладОрдер;
КонецЦикла;

Объект.СуммаДокумента = Объект.товары.Итог("Сумма"); 
Объект.Записать();

доСФ = Документы.СчетФактураПолученный.СоздатьДокумент();
доСФ.Заполнить(Объект.Ссылка);
доСФ.НомерВходящегоДокумента = НомерСчетаФактуры; 
доСФ.Дата = Объект.Дата;
доСФ.ДатаВходящегоДокумента = Объект.Дата;
//попытка
///	доСФ.Записать(РежимЗаписиДокумента.Проведение);
//исключение	
	доСФ.Записать();  
//	ЗаписьЖурналаРегистрации(НСтр("ru = 'Выполнение операции'"),
//       УровеньЖурналаРегистрации.Ошибка,,,
//       ОбработкаОшибок.ПодробноеПредставлениеОшибки(ИнформацияОбОшибке()));
//конецпопытки;</Текст>
		</Алгоритм>
		<Алгоритм Имя="СоздатьЗакрытиеЗаказовПокупателей" ИспользуетсяПриЗагрузке="true">
			<Текст>доЗакрытиеЗаказовПокупателей = Документы.ЗакрытиеЗаказовПокупателей.СоздатьДокумент();
доЗакрытиеЗаказовПокупателей.Заполнить(ОбъектСсылка);
//Для каждого СтрокаТЧ из доЗакрытиеЗаказовПокупателей.Заказы Цикл
//	СтрокаТЧ.ПричинаОтменыЗаказа = Справочники.КД_ПричиныОтменыЗаказов.НайтиПоКоду("108");
//КонецЦикла;
Если не ЗначениеЗаполнено(доЗакрытиеЗаказовПокупателей.Дата) тогда 
	доЗакрытиеЗаказовПокупателей.Дата = ТекущаяДатаСеанса(); 
КонецЕсли; 
//changed+ Долгих Н. 27.05.2025
Попытка
	//доЗакрытиеЗаказовПокупателей.Записать(РежимЗаписиДокумента.Проведение);
	Если ЗначениеЗаполнено(РТУ) Тогда
		Параметры.мРТУдляУдаления.Добавить(РТУ);
	КонецЕсли; 

	доЗакрытиеЗаказовПокупателей.Записать(РежимЗаписиДокумента.Запись);
	
	СтрокаТаблицы = Параметры.ДокументыДляОтложенногоПроведенияДоп.Добавить();
	СтрокаТаблицы.ДокументСсылка = доЗакрытиеЗаказовПокупателей.Ссылка;
	СтрокаТаблицы.ДатаДокумента  = доЗакрытиеЗаказовПокупателей.Дата;
	СтрокаТаблицы.ЭтоКоллизия = Ложь;
Исключение
	Отказ = Истина;
	ОписаниеОшибки = КраткоеПредставлениеОшибки(ИнформацияОбОшибке());
	Сообщить("Документ ""Закрытие заказов покупателей"" не записан: " + ОписаниеОшибки);
	ЗаписьЖурналаРегистрацииОбменДанными(ОписаниеОшибки, УровеньЖурналаРегистрации.Предупреждение);
	
КонецПопытки;
//changed- Долгих Н. 27.05.2025</Текст>
			<Параметры>ОбъектСсылка, РТУ, Параметры</Параметры>
		</Алгоритм>
	</Алгоритмы>
	<Запросы>
		<Запрос Имя="ЗакрытияЗаказов" ИспользуетсяПриЗагрузке="true">
			<Текст>ВЫБРАТЬ
	т.Ссылка КАК Заказ,
	т.СтатусЗаказа,
	т.кд_СтатусЗаказа
ПОМЕСТИТЬ вт_Заказы
ИЗ
	Документ.ЗаказПокупателя КАК т
ГДЕ
	ИСТИНА
	И т.Ссылка = &amp;Заказ
	И т.Проведен = ИСТИНА
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ РАЗЛИЧНЫЕ
	т.Ссылка,
	тч.ЗаказПокупателя
ПОМЕСТИТЬ вт_закрытия
ИЗ
	Документ.ЗакрытиеЗаказовПокупателей.Заказы КАК тч
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗакрытиеЗаказовПокупателей КАК т
		ПО (т.Ссылка = тч.Ссылка)
ГДЕ
	т.Проведен = ИСТИНА
	И тч.ЗаказПокупателя В
			(ВЫБРАТЬ
				т.Заказ
			ИЗ
				вт_заказы КАК т)
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	МАКСИМУМ(т.Ссылка) КАК РТУ,
	тз.Заказ
ПОМЕСТИТЬ вт_рту
ИЗ
	Документ.РеализацияТоваровУслуг КАК т
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ вт_Заказы КАК тз
		ПО т.Сделка = тз.Заказ
			И (т.Проведен = ИСТИНА)

СГРУППИРОВАТЬ ПО
	тз.Заказ
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	МАКСИМУМ(т.Ссылка) КАК РО,
	тз.Заказ
ПОМЕСТИТЬ вт_ро
ИЗ
	Документ.РасходныйОрдерНаТовары КАК т
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ вт_рту КАК тз
		ПО т.ДокументПередачи = тз.РТУ
			И (т.Проведен = ИСТИНА)

СГРУППИРОВАТЬ ПО
	тз.Заказ
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	т.Заказ,
	т.СтатусЗаказа,
	т.кд_СтатусЗаказа,
	тз.Ссылка КАК Закрытие,
	тРТУ.РТУ,
	тРО.РО
ИЗ
	вт_Заказы КАК т
		ЛЕВОЕ СОЕДИНЕНИЕ вт_закрытия КАК тз
		ПО т.Заказ = тз.ЗаказПокупателя
		ЛЕВОЕ СОЕДИНЕНИЕ вт_рту КАК тРТУ
		ПО т.Заказ = тРТУ.Заказ
		ЛЕВОЕ СОЕДИНЕНИЕ вт_ро КАК тРО
		ПО т.Заказ = тРО.Заказ</Текст>
		</Запрос>
		<Запрос Имя="ПолучитьДанныеДляОтложенногоПроведения" ИспользуетсяПриЗагрузке="true">
			<Текст>ВЫБРАТЬ
	РеализацияТоваровУслуг.Ссылка КАК Реализация
ПОМЕСТИТЬ ВТ_Реализации
ИЗ
	Документ.РеализацияТоваровУслуг КАК РеализацияТоваровУслуг
ГДЕ
	РеализацияТоваровУслуг.Сделка = &amp;Сделка
	И РеализацияТоваровУслуг.ПометкаУдаления = ЛОЖЬ
	И РеализацияТоваровУслуг.Проведен = ИСТИНА
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	СчетФактураВыданныйДокументыОснования.Ссылка КАК СчетФактура,
	ВТ_Реализации.Реализация
ПОМЕСТИТЬ ВТ_СФ
ИЗ
	Документ.СчетФактураВыданный.ДокументыОснования КАК СчетФактураВыданныйДокументыОснования
		ЛЕВОЕ СОЕДИНЕНИЕ Документ.СчетФактураВыданный КАК СчетФактураВыданный
		ПО СчетФактураВыданныйДокументыОснования.Ссылка = СчетФактураВыданный.Ссылка
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_Реализации КАК ВТ_Реализации
		ПО (СчетФактураВыданныйДокументыОснования.ДокументОснование = ВТ_Реализации.Реализация)
ГДЕ
	НЕ ВТ_Реализации.Реализация ЕСТЬ NULL

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	СчетФактураВыданный.Ссылка,
	ВТ_Реализации.Реализация
ИЗ
	Документ.СчетФактураВыданный КАК СчетФактураВыданный
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_Реализации КАК ВТ_Реализации
		ПО СчетФактураВыданный.ДокументОснование = ВТ_Реализации.Реализация
ГДЕ
	НЕ ВТ_Реализации.Реализация ЕСТЬ NULL
	И СчетФактураВыданный.ПометкаУдаления = ЛОЖЬ
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВТ_СФ.СчетФактура,
	ВТ_СФ.Реализация
ПОМЕСТИТЬ ВТ_Результат
ИЗ
	ВТ_СФ КАК ВТ_СФ

СГРУППИРОВАТЬ ПО
	ВТ_СФ.Реализация,
	ВТ_СФ.СчетФактура
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВТ_Результат.СчетФактура,
	ВТ_Результат.Реализация
ИЗ
	ВТ_Результат КАК ВТ_Результат</Текст>
		</Запрос>
		<Запрос Имя="ПолучитьКонтрагента" ИспользуетсяПриЗагрузке="false">
			<Текст>ВЫБРАТЬ ПЕРВЫЕ 1
	CG_Online_IWS_НастройкиАвторизации.Контрагент КАК Контрагент
ИЗ
	Справочник.CG_Online_IWS_НастройкиАвторизации КАК CG_Online_IWS_НастройкиАвторизации
ГДЕ
	CG_Online_IWS_НастройкиАвторизации.Сервис = &amp;Сервис

СГРУППИРОВАТЬ ПО
	CG_Online_IWS_НастройкиАвторизации.Контрагент</Текст>
		</Запрос>
		<Запрос Имя="ТоварыЗаказаКлиентаДоп" ИспользуетсяПриЗагрузке="false">
			<Текст>ВЫБРАТЬ                                  // ЗаказКлиентаСервиса,
	ТоварыСервиса.Цена как цена,
	ТоварыСервиса.КодСтроки КАК КодСтроки,
	РЗСТ.Количество КАК Количество,
	РЗСТ.Товар.Номенклатура КАК Номенклатура,
	РЗСТ.ИдентификаторЗаказа КАК СРИД, 
	РЗСТ.НомерЗаказа КАК НомерЗаказа,
	РЗСТ.НомерЗаказа КАК НомерСборочногоЗадания,      
	ТоварыСервиса.СтикерЗначение КАК СтикерЗначение
ИЗ 
 РегистрСведений.CG_Online_ЗаказыКлиентовСервисовТовары КАК РЗСТ
		//ЛЕВОЕ 
		внутреннее СОЕДИНЕНИЕ Документ.CG_Online_ЗаказКлиентаСервиса.Товары КАК ТоварыСервиса
		//ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.CG_Online_ЗаказыКлиентовСервисовМаркировкаТоваров КАК ТоварыСервиса
		ПО (ТоварыСервиса.Ссылка = РЗСТ.ЗаказКлиентаСервиса)
			И (ТоварыСервиса.Товар = РЗСТ.Товар)
ГДЕ
	рзст.ЗаказКлиента = &amp;ЗаказКлиента          
	//И рзст.Отменено=Ложь


//выбрать 
//КодСтроки,Номенклатура,Количество,
//"001ИдентификаторЗаказа" как Срид,
//"002НомерЗаказа" КАК НомерСборочногоЗадания,
//"003СтикерЗначение" как СтикерЗначение

// Из документ.ЗаказКлиента.Товары КАК _
//Где Ссылка=&amp;Ссылка

//СРИД, 
//СтикерЗначение 
//НомерСборочногоЗадания        00УТ-000740</Текст>
		</Запрос>
	</Запросы>
</ПравилаОбмена>