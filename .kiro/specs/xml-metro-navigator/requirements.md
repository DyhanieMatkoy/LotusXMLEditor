# Requirements Document

## Introduction

Интерактивный графический навигатор по структуре XML-документов, представляющий иерархию узлов в виде карты железнодорожных станций. Система визуализирует первые три уровня XML-иерархии, где каждый узел отображается как станция, с интеллектуальным алгоритмом размещения для обеспечения читаемости и возможностью масштабирования.

## Glossary

- **XML_Navigator**: Система визуализации и навигации по структуре XML
- **Station_Node**: Графическое представление XML-узла в виде станции
- **Metro_Canvas**: Холст для отрисовки карты станций
- **Layout_Engine**: Алгоритм интеллектуального размещения узлов
- **Zoom_Controller**: Компонент управления масштабированием
- **XML_Parser**: Парсер для извлечения структуры XML
- **Connection_Line**: Линия связи между родительским и дочерним узлами

## Requirements

### Requirement 1: Парсинг XML-структуры

**User Story:** Как пользователь, я хочу загрузить XML-документ, чтобы увидеть его структуру в графическом виде.

#### Acceptance Criteria

1. WHEN пользователь открывает XML-файл, THEN THE XML_Parser SHALL извлечь иерархическую структуру до третьего уровня вложенности
2. WHEN XML-документ содержит более трёх уровней, THEN THE XML_Parser SHALL ограничить извлечение первыми тремя уровнями
3. WHEN XML-документ имеет некорректный синтаксис, THEN THE XML_Parser SHALL вернуть описательное сообщение об ошибке
4. WHEN узел содержит атрибуты, THEN THE XML_Parser SHALL сохранить информацию об атрибутах для отображения

### Requirement 2: Интеллектуальное размещение узлов

**User Story:** Как пользователь, я хочу видеть узлы размещёнными оптимально, чтобы карта была читаемой и понятной.

#### Acceptance Criteria

1. WHEN Layout_Engine размещает узлы, THEN THE Layout_Engine SHALL минимизировать пересечения линий связи между узлами
2. WHEN узлы имеют разное количество дочерних элементов, THEN THE Layout_Engine SHALL распределить пространство пропорционально количеству потомков
3. WHEN граф содержит более 50 узлов, THEN THE Layout_Engine SHALL группировать узлы по родительским элементам для улучшения читаемости
4. WHEN размещение завершено, THEN THE Layout_Engine SHALL обеспечить минимальное расстояние между узлами не менее 80 пикселей
5. WHEN узлы размещаются на разных уровнях, THEN THE Layout_Engine SHALL использовать вертикальное расстояние между уровнями не менее 120 пикселей

### Requirement 3: Визуализация узлов как станций

**User Story:** Как пользователь, я хочу видеть XML-узлы в виде станций метро, чтобы интуитивно понимать структуру документа.

#### Acceptance Criteria

1. WHEN узел отображается, THEN THE Station_Node SHALL показывать имя XML-элемента в стиле названия станции
2. WHEN узел является корневым элементом, THEN THE Station_Node SHALL использовать увеличенный размер и отличительный цвет
3. WHEN узел имеет дочерние элементы, THEN THE Station_Node SHALL отображать индикатор количества потомков
4. WHEN пользователь наводит курсор на узел, THEN THE Station_Node SHALL показывать всплывающую подсказку с атрибутами и количеством дочерних элементов
5. WHEN узлы соединяются линиями, THEN THE Connection_Line SHALL отображаться в стиле линий метро с закруглёнными углами

### Requirement 4: Интерактивное взаимодействие

**User Story:** Как пользователь, я хочу взаимодействовать с картой, чтобы исследовать структуру XML-документа.

#### Acceptance Criteria

1. WHEN пользователь кликает на узел, THEN THE XML_Navigator SHALL выделить узел и показать его полную информацию в боковой панели
2. WHEN пользователь дважды кликает на узел, THEN THE XML_Navigator SHALL открыть этот узел в основном редакторе XML
3. WHEN пользователь перетаскивает холст, THEN THE Metro_Canvas SHALL перемещать всю карту в направлении перетаскивания
4. WHEN пользователь использует колесо мыши, THEN THE Zoom_Controller SHALL изменять масштаб карты с центром в позиции курсора
5. WHEN узел выделен, THEN THE XML_Navigator SHALL подсветить путь от корня до выделенного узла

### Requirement 5: Масштабирование и навигация

**User Story:** Как пользователь, я хочу масштабировать карту, чтобы видеть детали или общую картину структуры.

#### Acceptance Criteria

1. WHEN пользователь изменяет масштаб, THEN THE Zoom_Controller SHALL поддерживать диапазон масштабирования от 25% до 400%
2. WHEN масштаб меньше 50%, THEN THE Station_Node SHALL упрощать отображение, показывая только имена узлов
3. WHEN масштаб больше 150%, THEN THE Station_Node SHALL показывать дополнительные детали (атрибуты, количество потомков)
4. WHEN пользователь нажимает кнопку "Fit to View", THEN THE Zoom_Controller SHALL автоматически подобрать масштаб для отображения всей карты
5. WHEN карта масштабируется, THEN THE Zoom_Controller SHALL применять плавную анимацию перехода длительностью 300 миллисекунд

### Requirement 6: Производительность и оптимизация

**User Story:** Как пользователь, я хочу, чтобы карта работала плавно, даже при большом количестве узлов.

#### Acceptance Criteria

1. WHEN карта содержит более 200 узлов, THEN THE Metro_Canvas SHALL использовать виртуализацию для отрисовки только видимых элементов
2. WHEN пользователь перемещает или масштабирует карту, THEN THE Metro_Canvas SHALL обновлять отображение с частотой не менее 30 кадров в секунду
3. WHEN Layout_Engine вычисляет позиции узлов, THEN THE Layout_Engine SHALL завершить расчёт за время не более 3 секунд для 300 узлов
4. WHEN карта отображается впервые, THEN THE XML_Navigator SHALL показать индикатор загрузки во время построения графа

### Requirement 7: Интеграция с основным приложением

**User Story:** Как пользователь, я хочу открывать навигатор из главного окна редактора, чтобы быстро исследовать структуру текущего XML-документа.

#### Acceptance Criteria

1. WHEN пользователь выбирает пункт меню "View → XML Metro Navigator", THEN THE XML_Navigator SHALL открыть окно навигатора с текущим XML-документом
2. WHEN в редакторе нет открытого XML-документа, THEN THE XML_Navigator SHALL предложить выбрать файл для открытия
3. WHEN пользователь выбирает узел в навигаторе, THEN THE XML_Navigator SHALL синхронизировать позицию курсора в основном редакторе
4. WHEN пользователь изменяет XML в редакторе, THEN THE XML_Navigator SHALL предложить обновить карту
5. WHEN окно навигатора закрывается, THEN THE XML_Navigator SHALL сохранить текущие настройки масштаба и позиции для следующего открытия
