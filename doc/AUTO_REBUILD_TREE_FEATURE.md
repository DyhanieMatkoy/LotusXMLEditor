# Auto Rebuild Tree Feature

## Обзор

Опция **AutoRebuildTree** позволяет контролировать автоматическое обновление дерева XML при изменении текста в редакторе.

## Функциональность

### Когда опция включена (по умолчанию)
- Дерево автоматически обновляется после изменения текста в редакторе
- Используется задержка (debounce) перед обновлением для оптимизации производительности
- Задержка настраивается в настройках (по умолчанию 5000 мс)

### Когда опция выключена
- Дерево НЕ обновляется автоматически при изменении текста
- Слева от кнопки "Rebuild Tree" появляется индикатор ⚠ оранжевого цвета
- Индикатор показывает, что дерево требует обновления
- При наведении на индикатор отображается подсказка: "Tree needs rebuild - click 'Rebuild Tree' to update"
- При нажатии на кнопку "Rebuild Tree" (F11) дерево обновляется вручную и индикатор исчезает

## Настройка

### Через диалог настроек
1. Откройте меню **Settings** → **Settings...**
2. В разделе **Tree Updates** найдите опцию **Auto Rebuild Tree**
3. Установите или снимите флажок
4. Нажмите **OK** для применения изменений

### Программно
Настройка сохраняется в QSettings под ключом `flags/auto_rebuild_tree`:

```python
from PyQt6.QtCore import QSettings

settings = QSettings("visxml.net", "LotusXmlEditor")

# Включить автоматическое обновление
settings.setValue("flags/auto_rebuild_tree", True)

# Выключить автоматическое обновление
settings.setValue("flags/auto_rebuild_tree", False)

# Прочитать текущее значение
auto_rebuild = settings.value("flags/auto_rebuild_tree", True, type=bool)
```

## Использование

### Сценарий 1: Работа с большими файлами
При работе с большими XML файлами автоматическое обновление дерева может замедлять работу. В этом случае:
1. Выключите опцию **Auto Rebuild Tree** в настройках
2. Редактируйте XML в редакторе
3. Когда появится индикатор ⚠, нажмите **Rebuild Tree** (F11) для обновления дерева

### Сценарий 2: Быстрое редактирование
При быстром редактировании небольших файлов удобно использовать автоматическое обновление:
1. Убедитесь, что опция **Auto Rebuild Tree** включена (по умолчанию)
2. Редактируйте XML в редакторе
3. Дерево автоматически обновится через 5 секунд после остановки ввода

## Технические детали

### Индикатор обновления
- **Символ**: ⚠ (Unicode U+26A0)
- **Цвет**: Оранжевый
- **Размер шрифта**: 16px
- **Расположение**: Слева от кнопки "Rebuild Tree" в toolbar
- **Видимость**: Показывается только когда `auto_rebuild_tree = False` и текст был изменен

### Логика работы
1. При изменении текста в редакторе вызывается `on_content_changed()`
2. Если `auto_rebuild_tree = True`:
   - Запускается таймер debounce
   - После истечения таймера дерево обновляется автоматически
3. Если `auto_rebuild_tree = False`:
   - Устанавливается флаг `_tree_needs_rebuild = True`
   - Показывается индикатор `tree_rebuild_indicator`
   - Дерево НЕ обновляется
4. При нажатии "Rebuild Tree":
   - Флаг `_tree_needs_rebuild` сбрасывается
   - Индикатор скрывается
   - Дерево обновляется вручную

## Связанные настройки

- **Debounce Interval (ms)**: Задержка перед автоматическим обновлением дерева (по умолчанию 5000 мс)
- Находится в том же разделе **Tree Updates** в настройках

## Горячие клавиши

- **F11**: Rebuild Tree (обновить дерево вручную)
