#python todo3.md
import xml.etree.ElementTree as ET

def print_human_readable_1c_xml(xml_string):
    # Оборачиваем в корневой тег, так как входящий XML может быть фрагментом
    xml_string = f"<Root>{xml_string}</Root>"
    
    try:
        root = ET.fromstring(xml_string)
    except ET.ParseError as e:
        print(f"Ошибка парсинга XML: {e}")
        return

    for node in root:
        if node.tag == "ДанныеПоОбмену":
            print("=" * 50)
            print("ДАННЫЕ ПО ОБМЕНУ")
            print("=" * 50)
            for attr, val in node.attrib.items():
                print(f"{attr}: {val}")
            print("")

        elif node.tag == "Объект":
            obj_type = node.get("Тип")
            npp = node.get("Нпп")
            print("-" * 50)
            print(f"ОБЪЕКТ [{npp}]: {obj_type}")
            print("-" * 50)

            for child in node:
                # Обычное свойство
                if child.tag == "Свойство":
                    name = child.get("Имя")
                    val_elem = child.find("Значение")
                    link_elem = child.find("Ссылка")

                    value = ""
                    if val_elem is not None:
                        value = val_elem.text
                    elif link_elem is not None:
                        # Если это ссылка, попробуем достать Код или УИД из вложенных свойств
                        uid_prop = link_elem.find(".//Свойство[@Имя='{УникальныйИдентификатор}']/Значение")
                        code_prop = link_elem.find(".//Свойство[@Имя='Код']/Значение")
                        
                        if uid_prop is not None:
                            value = f"[Ссылка: {uid_prop.text}]"
                        elif code_prop is not None:
                            value = f"[Ссылка (Код): {code_prop.text}]"
                        else:
                            value = "[Ссылка]"

                    if value is None: value = ""
                    
                    # Форматирование многострочных комментариев
                    if "\n" in value:
                        print(f"{name}:")
                        for line in value.split("\n"):
                            print(f"  {line}")
                    else:
                        print(f"{name}: {value}")

                # Табличная часть
                elif child.tag == "ТабличнаяЧасть":
                    tb_name = child.get("Имя")
                    print(f"\n[Табличная часть: {tb_name}]")
                    
                    # Заголовки колонок (берем из первой строки для примера)
                    first_row = child.find("Запись")
                    if first_row is not None:
                        headers = []
                        for prop in first_row.findall("Свойство"):
                            headers.append(prop.get("Имя"))
                        print(f"  | {' | '.join(headers)} |")
                        print("  " + "-" * (len(" | ".join(headers)) + 2))

                    for row in child.findall("Запись"):
                        row_vals = []
                        for prop in row.findall("Свойство"):
                            v_elem = prop.find("Значение")
                            row_vals.append(v_elem.text if v_elem is not None else "")
                        print(f"  | {' | '.join(row_vals)} |")
                    print("")

                # Параметры (свойства объекта, не являющиеся реквизитами, например, для КД)
                elif child.tag == "ЗначениеПараметра":
                    name = child.get("Имя")
                    val = child.findtext("Значение")
                    print(f"* {name}: {val}")
            
            print("")

# Входящий XML
xml_data = """
<ДанныеПоОбмену ПланОбмена="кд_УОТ_УТ10" Кому="UT10" ОтКого="UOT2" НомерИсходящегоСообщения="1094" НомерВходящегоСообщения="0" УдалитьРегистрациюИзменений="true" ВерсияОтправителя="11.5.25.85"/>
<Объект Нпп="1" Тип="ДокументСсылка.ЗаказПокупателя" ИмяПравила="ЗаказПокупателя"><Ссылка>
    <Свойство Имя="{УникальныйИдентификатор}" Тип="Строка" ТипИсточника="ДокументСсылка.ЗаказКлиента" ТипПриемника="ДокументСсылка.ЗаказПокупателя">
        <Значение>29aa9a5e-0655-11f1-8ceb-005056a0e358</Значение>
    </Свойство>
</Ссылка>
    <Свойство Имя="ДатаОтгрузки" Тип="Дата">
        <Значение>2026-02-10T00:00:00</Значение>
    </Свойство>
    <Свойство Имя="кд_МаркетПлейс" Тип="ПеречислениеСсылка.кд_МаркетПлейсы">
        <Значение>ВБ</Значение>
    </Свойство>
    <Свойство Имя="Комментарий" Тип="Строка"/>
    <Свойство Имя="КомментарийКЦ" Тип="Строка">
        <Значение>Номер сборочного задания WB: 4607536996
Номер сборочного задания WB: 4607536999
ИД Склада: 1666485</Значение>
    </Свойство>
    <ЗначениеПараметра Имя="кд_интернетНомерСклада" Тип="Число">
        <Значение>227</Значение>
    </ЗначениеПараметра>
    <Свойство Имя="ПометкаУдаления" Тип="Булево">
        <Значение>false</Значение>
    </Свойство>
    <Свойство Имя="Проведен" Тип="Булево">
        <Значение>true</Значение>
    </Свойство>
    <Свойство Имя="ВалютаДокумента" Тип="СправочникСсылка.Валюты"><Ссылка НеСоздаватьЕслиНеНайден="true">
    <Свойство Имя="Код" Тип="Строка">
        <Значение>643</Значение>
    </Свойство>
</Ссылка>
    </Свойство>
    <Свойство Имя="кд_СтатусЗаказа" Тип="ПеречислениеСсылка.кд_СтатусыЗаказов_МП">
        <Значение>Принят</Значение>
    </Свойство><ТабличнаяЧасть Имя="Товары">
    <Запись>
        <Свойство Имя="КодСтроки" Тип="Число">
            <Значение>1</Значение>
        </Свойство>
        <Свойство Имя="Количество" Тип="Число">
            <Значение>1</Значение>
        </Свойство>
        <Свойство Имя="Номенклатура" Тип="СправочникСсылка.Номенклатура" ИмяПКО="Номенклатура"><Ссылка НеСоздаватьЕслиНеНайден="true">
    <Свойство Имя="Код" Тип="Строка">
        <Значение>7264605</Значение>
    </Свойство>
</Ссылка>
        </Свойство>
        <Свойство Имя="ХарактеристикаНоменклатуры" Тип="СправочникСсылка.ХарактеристикиНоменклатуры"><Ссылка НеСоздаватьЕслиНеНайден="true">
    <Свойство Имя="Код" Тип="Строка">
        <Значение>00</Значение>
    </Свойство>
    <Свойство Имя="Владелец" Тип="СправочникСсылка.Номенклатура" ИмяПКО="Номенклатура"><Ссылка НеСоздаватьЕслиНеНайден="true">
    <Свойство Имя="Код" Тип="Строка">
        <Значение>7264605</Значение>
    </Свойство>
</Ссылка>
    </Свойство>
</Ссылка>
        </Свойство>
        <Свойство Имя="Цена" Тип="Число">
            <Значение>5819</Значение>
        </Свойство>
    </Запись>
    <Запись>
        <Свойство Имя="КодСтроки" Тип="Число">
            <Значение>2</Значение>
        </Свойство>
        <Свойство Имя="Количество" Тип="Число">
            <Значение>1</Значение>
        </Свойство>
        <Свойство Имя="Номенклатура" Тип="СправочникСсылка.Номенклатура" ИмяПКО="Номенклатура"><Ссылка НеСоздаватьЕслиНеНайден="true">
    <Свойство Имя="Код" Тип="Строка">
        <Значение>7264605</Значение>
    </Свойство>
</Ссылка>
        </Свойство>
        <Свойство Имя="ХарактеристикаНоменклатуры" Тип="СправочникСсылка.ХарактеристикиНоменклатуры"><Ссылка НеСоздаватьЕслиНеНайден="true">
    <Свойство Имя="Код" Тип="Строка">
        <Значение>00</Значение>
    </Свойство>
    <Свойство Имя="Владелец" Тип="СправочникСсылка.Номенклатура" ИмяПКО="Номенклатура"><Ссылка НеСоздаватьЕслиНеНайден="true">
    <Свойство Имя="Код" Тип="Строка">
        <Значение>7264605</Значение>
    </Свойство>
</Ссылка>
    </Свойство>
</Ссылка>
        </Свойство>
        <Свойство Имя="Цена" Тип="Число">
            <Значение>5819</Значение>
        </Свойство>
    </Запись>
</ТабличнаяЧасть>
    <ЗначениеПараметра Имя="ЭтоWildberries" Тип="Булево">
        <Значение>true</Значение>
    </ЗначениеПараметра>
</Объект>
"""

print_human_readable_1c_xml(xml_data)